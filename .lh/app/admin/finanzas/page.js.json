{
    "sourceFile": "app/admin/finanzas/page.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1767122459551,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767122697341,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -108,9 +108,9 @@\n               className=\"flex items-center gap-2 text-blue-500 text-[10px] font-black uppercase tracking-widest mb-4 hover:opacity-70 transition-all\"\n             >\n               <ArrowLeft size={14} /> Volver al Control\n             </Link>\n-            <h1 className=\"text-4xl font-black italic uppercase tracking-tighter\">\n+            <h1 className=\"text-4xl font-black  uppercase tracking-tighter\">\n               Reporte de <span className=\"text-blue-500\">Ingresos</span>\n             </h1>\n           </div>\n \n@@ -181,9 +181,9 @@\n             </div>\n             <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-1\">\n               Mes Seleccionado\n             </p>\n-            <h2 className=\"text-2xl font-black tracking-tighter uppercase italic\">\n+            <h2 className=\"text-2xl font-black tracking-tighter uppercase \">\n               {months[selectedMonth]}\n             </h2>\n           </div>\n         </div>\n"
                },
                {
                    "date": 1767122747725,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -103,9 +103,9 @@\n         {/* Header */}\n         <header className=\"flex flex-col md:flex-row justify-between items-start md:items-center mb-12 gap-6\">\n           <div>\n             <Link\n-              href=\"/admin/control-panel\"\n+              href=\"/admin/control\"\n               className=\"flex items-center gap-2 text-blue-500 text-[10px] font-black uppercase tracking-widest mb-4 hover:opacity-70 transition-all\"\n             >\n               <ArrowLeft size={14} /> Volver al Control\n             </Link>\n"
                }
            ],
            "date": 1767122459551,
            "name": "Commit-0",
            "content": "\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { db, auth } from \"@/services/firebase\";\nimport { onAuthStateChanged } from \"firebase/auth\";\nimport { collection, getDocs } from \"firebase/firestore\";\nimport { \n  TrendingUp, \n  DollarSign, \n  Calendar, \n  ArrowLeft, \n  Loader2, \n  Lock,\n  Filter,\n  BarChart3\n} from \"lucide-react\";\nimport Link from \"next/link\";\n\nexport default function FinancePage() {\n  const [loading, setLoading] = useState(true);\n  const [isAuthorized, setIsAuthorized] = useState(false);\n  const [barberias, setBarberias] = useState([]);\n  const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth()); // Mes actual (0-11)\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n\n  const ADMIN_EMAIL = process.env.NEXT_PUBLIC_ADMIN_EMAIL || \"cleberich@gmail.com\";\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      if (user && user.email === ADMIN_EMAIL) {\n        setIsAuthorized(true);\n        await fetchData();\n      }\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, [selectedMonth, selectedYear]);\n\n  const fetchData = async () => {\n    try {\n      const querySnapshot = await getDocs(collection(db, \"barberias\"));\n      const docs = querySnapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setBarberias(docs);\n    } catch (error) {\n      console.error(\"Error cargando finanzas:\", error);\n    }\n  };\n\n  // Lógica de filtrado: Obtenemos barberías que pagaron en el mes/año seleccionado\n  const filteredPayments = barberias.filter(b => {\n    if (!b.plan?.lastPayment) return false;\n    const payDate = b.plan.lastPayment.toDate ? b.plan.lastPayment.toDate() : new Date(b.plan.lastPayment.seconds * 1000);\n    return payDate.getMonth() === selectedMonth && payDate.getFullYear() === selectedYear;\n  });\n\n  const totalIncome = filteredPayments.reduce((acc, b) => acc + (Number(b.plan?.price) || 0), 0);\n\n  const months = [\n    \"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\",\n    \"Julio\", \"Agosto\", \"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\"\n  ];\n\n  if (loading) return (\n    <div className=\"h-screen flex items-center justify-center bg-[#0a0f1a]\">\n      <Loader2 className=\"animate-spin text-blue-500\" size={40} />\n    </div>\n  );\n\n  if (!isAuthorized) return (\n    <div className=\"h-screen flex flex-col items-center justify-center bg-[#0a0f1a] text-center\">\n      <Lock className=\"text-red-500 mb-4\" size={40} />\n      <h1 className=\"text-white font-black uppercase\">No tienes permiso</h1>\n    </div>\n  );\n\n  return (\n    <div className=\"min-h-screen bg-[#0a0f1a] text-white p-6 md:p-12\">\n      <div className=\"max-w-6xl mx-auto\">\n        \n        {/* Header */}\n        <header className=\"flex flex-col md:flex-row justify-between items-start md:items-center mb-12 gap-6\">\n          <div>\n            <Link href=\"/admin/control-panel\" className=\"flex items-center gap-2 text-blue-500 text-[10px] font-black uppercase tracking-widest mb-4 hover:opacity-70 transition-all\">\n              <ArrowLeft size={14} /> Volver al Control\n            </Link>\n            <h1 className=\"text-4xl font-black italic uppercase tracking-tighter\">Reporte de <span className=\"text-blue-500\">Ingresos</span></h1>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <div className=\"bg-slate-900 border border-white/5 rounded-2xl p-2 flex gap-2\">\n              <select \n                value={selectedMonth} \n                onChange={(e) => setSelectedMonth(parseInt(e.target.value))}\n                className=\"bg-transparent text-xs font-black uppercase p-2 outline-none border-none cursor-pointer\"\n              >\n                {months.map((m, i) => <option key={m} value={i} className=\"bg-slate-900\">{m}</option>)}\n              </select>\n              <select \n                value={selectedYear} \n                onChange={(e) => setSelectedYear(parseInt(e.target.value))}\n                className=\"bg-transparent text-xs font-black uppercase p-2 outline-none border-none cursor-pointer\"\n              >\n                {[2024, 2025, 2026].map(y => <option key={y} value={y} className=\"bg-slate-900\">{y}</option>)}\n              </select>\n            </div>\n          </div>\n        </header>\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-12\">\n          <div className=\"bg-blue-600 rounded-[2.5rem] p-8 shadow-xl shadow-blue-900/20\">\n            <div className=\"flex justify-between items-start mb-4\">\n              <div className=\"p-3 bg-white/10 rounded-2xl\"><DollarSign size={24} /></div>\n              <TrendingUp size={20} className=\"text-white/50\" />\n            </div>\n            <p className=\"text-[10px] font-black uppercase tracking-widest text-white/70 mb-1\">Recaudación del Mes</p>\n            <h2 className=\"text-4xl font-black tracking-tighter\">${totalIncome.toLocaleString()}</h2>\n          </div>\n\n          <div className=\"bg-slate-900 border border-white/5 rounded-[2.5rem] p-8\">\n            <div className=\"flex justify-between items-start mb-4\">\n              <div className=\"p-3 bg-blue-500/10 rounded-2xl\"><BarChart3 size={24} className=\"text-blue-500\" /></div>\n            </div>\n            <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-1\">Pagos Recibidos</p>\n            <h2 className=\"text-4xl font-black tracking-tighter\">{filteredPayments.length}</h2>\n          </div>\n\n          <div className=\"bg-slate-900 border border-white/5 rounded-[2.5rem] p-8\">\n            <div className=\"flex justify-between items-start mb-4\">\n              <div className=\"p-3 bg-emerald-500/10 rounded-2xl\"><Calendar size={24} className=\"text-emerald-500\" /></div>\n            </div>\n            <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-1\">Mes Seleccionado</p>\n            <h2 className=\"text-2xl font-black tracking-tighter uppercase italic\">{months[selectedMonth]}</h2>\n          </div>\n        </div>\n\n        {/* Payment List */}\n        <div className=\"bg-slate-900/50 border border-white/5 rounded-[3rem] overflow-hidden\">\n          <div className=\"p-8 border-b border-white/5 flex items-center gap-4\">\n            <Filter size={18} className=\"text-blue-500\" />\n            <h3 className=\"font-black uppercase text-sm tracking-widest\">Desglose de pagos</h3>\n          </div>\n\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-left\">\n              <thead>\n                <tr className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest border-b border-white/5\">\n                  <th className=\"px-8 py-6\">Barbería</th>\n                  <th className=\"px-8 py-6\">Plan</th>\n                  <th className=\"px-8 py-6 text-right\">Precio</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-white/5\">\n                {filteredPayments.map((b) => (\n                  <tr key={b.id} className=\"hover:bg-white/[0.02] transition-colors\">\n                    <td className=\"px-8 py-6\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"size-8 rounded-lg bg-slate-800 flex items-center justify-center font-black text-[10px] text-blue-500 uppercase\">\n                          {b.businessName?.[0]}\n                        </div>\n                        <span className=\"text-xs font-bold uppercase\">{b.businessName}</span>\n                      </div>\n                    </td>\n                    <td className=\"px-8 py-6\">\n                      <span className=\"text-[10px] font-black uppercase px-3 py-1 bg-slate-800 rounded-full text-slate-400\">\n                        {b.plan?.type || \"Básico\"}\n                      </span>\n                    </td>\n                    <td className=\"px-8 py-6 text-right font-black text-emerald-400\">\n                      ${Number(b.plan?.price || 0).toLocaleString()}\n                    </td>\n                  </tr>\n                ))}\n                {filteredPayments.length === 0 && (\n                  <tr>\n                    <td colSpan=\"3\" className=\"px-8 py-20 text-center text-slate-600 font-bold uppercase text-[10px] tracking-[0.3em]\">\n                      No hay registros de pagos para este periodo\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}"
        }
    ]
}