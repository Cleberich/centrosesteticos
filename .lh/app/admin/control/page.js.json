{
    "sourceFile": "app/admin/control/page.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1767122528782,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767122533799,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -147,9 +147,9 @@\n             <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-blue-500\">\n               Super Admin Panel\n             </span>\n           </div>\n-          <h1 className=\"text-4xl font-black uppercase tracking-tighter italic text-white\">\n+          <h1 className=\"text-4xl font-black uppercase tracking-tighter  text-white\">\n             Gestión de <span className=\"text-blue-500\">Barberias</span>\n           </h1>\n         </div>\n         <div className=\"relative group\">\n"
                },
                {
                    "date": 1767126559013,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,9 +36,9 @@\n   const [editingBarberia, setEditingBarberia] = useState(null);\n   const [newLastPayment, setNewLastPayment] = useState(\"\");\n \n   const ADMIN_EMAIL =\n-    process.env.NEXT_PUBLIC_ADMIN_EMAIL || \"cleberich@gmail.com\";\n+    process.env.NEXT_PUBLIC_ADMIN_EMAIL ;\n \n   const convertToDate = (dateValue) => {\n     if (!dateValue) return null;\n     if (typeof dateValue.toDate === \"function\") return dateValue.toDate();\n"
                },
                {
                    "date": 1767149440954,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,349 @@\n+// \"use client\";\n+\n+// import React, { useState, useEffect } from \"react\";\n+// import { auth, db } from \"@/services/firebase\";\n+// import { onAuthStateChanged } from \"firebase/auth\";\n+// import {\n+//   collection,\n+//   getDocs,\n+//   doc,\n+//   updateDoc,\n+//   Timestamp,\n+// } from \"firebase/firestore\";\n+// import {\n+//   ShieldCheck,\n+//   Search,\n+//   ExternalLink,\n+//   Loader2,\n+//   AlertOctagon,\n+//   CheckCircle2,\n+//   CreditCard,\n+//   Calendar,\n+//   Lock,\n+//   Edit2,\n+//   X,\n+//   Users,\n+//   BookmarkCheck,\n+// } from \"lucide-react\";\n+\n+// export default function SuperAdminPage() {\n+//   const [user, setUser] = useState(null);\n+//   const [barberias, setBarberias] = useState([]);\n+//   const [loading, setLoading] = useState(true);\n+//   const [isAuthorized, setIsAuthorized] = useState(false);\n+//   const [searchTerm, setSearchTerm] = useState(\"\");\n+\n+//   const [editingBarberia, setEditingBarberia] = useState(null);\n+//   const [newLastPayment, setNewLastPayment] = useState(\"\");\n+\n+//   const ADMIN_EMAIL = process.env.NEXT_PUBLIC_ADMIN_EMAIL;\n+\n+//   const convertToDate = (dateValue) => {\n+//     if (!dateValue) return null;\n+//     if (typeof dateValue.toDate === \"function\") return dateValue.toDate();\n+//     if (dateValue.seconds) return new Date(dateValue.seconds * 1000);\n+//     return new Date(dateValue);\n+//   };\n+\n+//   const formatDate = (dateValue) => {\n+//     const date = convertToDate(dateValue);\n+//     if (!date || isNaN(date.getTime())) return \"--/--/----\";\n+//     return date.toLocaleDateString(\"es-ES\", {\n+//       day: \"2-digit\",\n+//       month: \"short\",\n+//       year: \"numeric\",\n+//     });\n+//   };\n+\n+//   const isPaymentValid = (lastPayment) => {\n+//     const date = convertToDate(lastPayment);\n+//     if (!date) return false;\n+//     const today = new Date();\n+//     const diffInDays = (today.getTime() - date.getTime()) / (1000 * 3600 * 24);\n+//     return diffInDays <= 30 && diffInDays >= 0;\n+//   };\n+\n+//   useEffect(() => {\n+//     const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\n+//       if (currentUser && currentUser.email === ADMIN_EMAIL) {\n+//         setUser(currentUser);\n+//         setIsAuthorized(true);\n+//         await fetchBarberias();\n+//       } else {\n+//         setIsAuthorized(false);\n+//       }\n+//       setLoading(false);\n+//     });\n+//     return () => unsubscribe();\n+//   }, []);\n+\n+//   const fetchBarberias = async () => {\n+//     try {\n+//       const querySnapshot = await getDocs(collection(db, \"barberias\"));\n+//       const docs = querySnapshot.docs.map((doc) => ({\n+//         id: doc.id,\n+//         ...doc.data(),\n+//       }));\n+//       setBarberias(docs);\n+//     } catch (error) {\n+//       console.error(\"Error cargando barberías:\", error);\n+//     }\n+//   };\n+\n+//   const handleManualUpdate = async (e) => {\n+//     e.preventDefault();\n+//     if (!editingBarberia || !newLastPayment) return;\n+\n+//     try {\n+//       const lastPayDate = new Date(newLastPayment);\n+//       const nextPayDate = new Date(lastPayDate);\n+//       nextPayDate.setDate(lastPayDate.getDate() + 30);\n+\n+//       const docRef = doc(db, \"barberias\", editingBarberia.id);\n+//       await updateDoc(docRef, {\n+//         \"plan.lastPayment\": Timestamp.fromDate(lastPayDate),\n+//         \"plan.nextPayment\": Timestamp.fromDate(nextPayDate),\n+//         \"plan.paymentStatus\": \"paid\",\n+//       });\n+\n+//       setEditingBarberia(null);\n+//       await fetchBarberias();\n+//       alert(\"Barbería actualizada correctamente\");\n+//     } catch (error) {\n+//       alert(\"Error al actualizar\");\n+//     }\n+//   };\n+\n+//   const filteredBarberias = barberias.filter(\n+//     (b) =>\n+//       b.businessName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n+//       b.email?.toLowerCase().includes(searchTerm.toLowerCase())\n+//   );\n+\n+//   if (loading)\n+//     return (\n+//       <div className=\"h-screen flex items-center justify-center bg-[#0a0f1a]\">\n+//         <Loader2 className=\"animate-spin text-blue-500\" size={40} />\n+//       </div>\n+//     );\n+\n+//   if (!isAuthorized)\n+//     return (\n+//       <div className=\"h-screen flex flex-col items-center justify-center bg-[#0a0f1a] p-6 text-center\">\n+//         <Lock className=\"text-red-500 mb-6\" size={40} />\n+//         <h1 className=\"text-2xl font-black text-white uppercase tracking-tighter\">\n+//           Acceso Denegado\n+//         </h1>\n+//       </div>\n+//     );\n+\n+//   return (\n+//     <div className=\"min-h-screen bg-[#0a0f1a] text-slate-100 p-6 md:p-12 relative\">\n+//       <header className=\"max-w-7xl mx-auto mb-12 flex flex-col md:flex-row md:items-center justify-between gap-6\">\n+//         <div>\n+//           <div className=\"flex items-center gap-2 mb-2\">\n+//             <ShieldCheck className=\"text-blue-500\" size={20} />\n+//             <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-blue-500\">\n+//               Super Admin Panel\n+//             </span>\n+//           </div>\n+//           <h1 className=\"text-4xl font-black uppercase tracking-tighter  text-white\">\n+//             Gestión de <span className=\"text-blue-500\">Barberias</span>\n+//           </h1>\n+//         </div>\n+//         <div className=\"relative group\">\n+//           <Search\n+//             className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\"\n+//             size={18}\n+//           />\n+//           <input\n+//             placeholder=\"BUSCAR...\"\n+//             className=\"bg-slate-900 border border-white/5 rounded-2xl py-4 pl-12 pr-6 w-full md:w-80 text-xs font-bold outline-none focus:border-blue-500 transition-all placeholder:text-slate-600\"\n+//             onChange={(e) => setSearchTerm(e.target.value)}\n+//           />\n+//         </div>\n+//       </header>\n+\n+//       <main className=\"max-w-7xl mx-auto\">\n+//         <div className=\"grid grid-cols-1 gap-4\">\n+//           {/* HEADER DE TABLA */}\n+//           <div className=\"hidden md:grid grid-cols-7 px-8 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500\">\n+//             <span>Barbería / Info</span>\n+//             <span>Estadísticas</span>\n+//             <span>Plan</span>\n+//             <span>Estado</span>\n+//             <span>Último Pago</span>\n+//             <span>Próximo Venc.</span>\n+//             <span className=\"text-right\">Acciones</span>\n+//           </div>\n+\n+//           {filteredBarberias.map((b) => {\n+//             const isPaid =\n+//               b.plan?.paymentStatus === \"paid\" ||\n+//               isPaymentValid(b.plan?.lastPayment);\n+\n+//             // ACCESO A LOS ARRAYS: Contamos los barberos y las citas\n+//             const totalBarberos = Array.isArray(b.barbers)\n+//               ? b.barbers.length\n+//               : 0;\n+//             const totalCitas = Array.isArray(b.appointments)\n+//               ? b.appointments.length\n+//               : 0;\n+\n+//             return (\n+//               <div\n+//                 key={b.id}\n+//                 className=\"bg-slate-900/50 border border-white/5 rounded-[2.5rem] p-6 md:px-8 flex flex-col md:grid md:grid-cols-7 items-center gap-6 hover:border-blue-500/30 transition-all\"\n+//               >\n+//                 {/* 1. Nombre e Imagen */}\n+//                 <div className=\"flex items-center gap-4 w-full truncate\">\n+//                   <div className=\"size-10 rounded-xl bg-slate-800 border border-white/10 flex items-center justify-center shrink-0\">\n+//                     {b.logo ? (\n+//                       <img\n+//                         src={b.logo}\n+//                         className=\"w-full aspect-square rounded-lg object-cover\"\n+//                       />\n+//                     ) : (\n+//                       <span className=\"font-black text-blue-500\">\n+//                         {b.businessName?.[0]}\n+//                       </span>\n+//                     )}\n+//                   </div>\n+//                   <div className=\"truncate text-left\">\n+//                     <p className=\"font-black uppercase text-xs text-white truncate\">\n+//                       {b.businessName}\n+//                     </p>\n+//                     <p className=\"text-[9px] text-slate-500 font-bold truncate\">\n+//                       {b.email}\n+//                     </p>\n+//                   </div>\n+//                 </div>\n+\n+//                 {/* 2. Estadísticas desde los ARRAYS */}\n+//                 <div className=\"w-full flex gap-4\">\n+//                   <div className=\"flex flex-col\">\n+//                     <span className=\"text-[8px] font-black text-slate-500 uppercase tracking-tighter\">\n+//                       Barberos\n+//                     </span>\n+//                     <div className=\"flex items-center gap-1 text-xs font-black text-white\">\n+//                       <Users size={12} className=\"text-blue-500\" />{\" \"}\n+//                       {totalBarberos}\n+//                     </div>\n+//                   </div>\n+//                   <div className=\"flex flex-col\">\n+//                     <span className=\"text-[8px] font-black text-slate-500 uppercase tracking-tighter\">\n+//                       Citas\n+//                     </span>\n+//                     <div className=\"flex items-center gap-1 text-xs font-black text-white\">\n+//                       <BookmarkCheck size={12} className=\"text-emerald-500\" />{\" \"}\n+//                       {totalCitas}\n+//                     </div>\n+//                   </div>\n+//                 </div>\n+\n+//                 {/* 3. Plan */}\n+//                 <div className=\"w-full text-[10px] font-black uppercase text-blue-400\">\n+//                   {b.plan?.type || \"Básico\"}\n+//                 </div>\n+\n+//                 {/* 4. Estado de Pago */}\n+//                 <div className=\"w-full\">\n+//                   <span\n+//                     className={`text-[9px] font-black uppercase px-3 py-1 rounded-full border ${\n+//                       isPaid\n+//                         ? \"text-emerald-500 border-emerald-500/20 bg-emerald-500/5\"\n+//                         : \"text-amber-500 border-amber-500/20 bg-amber-500/5\"\n+//                     }`}\n+//                   >\n+//                     {isPaid ? \"ACTIVO\" : \"PENDIENTE\"}\n+//                   </span>\n+//                 </div>\n+\n+//                 {/* 5. Último Pago */}\n+//                 <div className=\"w-full text-[11px] font-bold text-slate-400\">\n+//                   {formatDate(b.plan?.lastPayment)}\n+//                 </div>\n+\n+//                 {/* 6. Próximo Pago */}\n+//                 <div className=\"w-full text-[11px] font-bold text-white\">\n+//                   {formatDate(b.plan?.nextPayment)}\n+//                 </div>\n+\n+//                 {/* 7. Botones */}\n+//                 <div className=\"flex justify-end w-full gap-2\">\n+//                   <button\n+//                     onClick={() => {\n+//                       setEditingBarberia(b);\n+//                       setNewLastPayment(\"\");\n+//                     }}\n+//                     className=\"p-3 bg-slate-800 border border-white/5 hover:border-blue-500 rounded-xl transition-all\"\n+//                   >\n+//                     <Edit2 size={16} className=\"text-slate-400\" />\n+//                   </button>\n+//                   <a\n+//                     href={`/reserva/${b.id}`}\n+//                     target=\"_blank\"\n+//                     className=\"p-3 bg-slate-800 border border-white/5 hover:bg-blue-600 rounded-xl transition-all text-slate-400 hover:text-white\"\n+//                   >\n+//                     <ExternalLink size={16} />\n+//                   </a>\n+//                 </div>\n+//               </div>\n+//             );\n+//           })}\n+//         </div>\n+//       </main>\n+\n+//       {/* MODAL DE EDICIÓN MANUAL */}\n+//       {editingBarberia && (\n+//         <div className=\"fixed inset-0 z-50 flex items-center justify-center p-6\">\n+//           <div\n+//             className=\"absolute inset-0 bg-black/80 backdrop-blur-sm\"\n+//             onClick={() => setEditingBarberia(null)}\n+//           ></div>\n+//           <div className=\"bg-slate-900 border border-white/10 w-full max-w-md rounded-[2.5rem] p-8 relative z-10 shadow-2xl animate-in zoom-in-95\">\n+//             <button\n+//               onClick={() => setEditingBarberia(null)}\n+//               className=\"absolute right-6 top-6 text-slate-500 hover:text-white\"\n+//             >\n+//               <X size={20} />\n+//             </button>\n+//             <h3 className=\"text-xl font-black uppercase italic mb-2 text-white\">\n+//               Editar <span className=\"text-blue-500\">Pago</span>\n+//             </h3>\n+//             <p className=\"text-slate-400 text-[10px] font-bold uppercase mb-6 tracking-widest\">\n+//               {editingBarberia.businessName}\n+//             </p>\n+//             <form onSubmit={handleManualUpdate} className=\"space-y-6\">\n+//               <div className=\"space-y-2\">\n+//                 <label className=\"text-[10px] font-black uppercase text-slate-500 ml-1 tracking-widest\">\n+//                   Fecha del último pago\n+//                 </label>\n+//                 <input\n+//                   type=\"date\"\n+//                   required\n+//                   className=\"w-full bg-slate-800 border border-white/10 rounded-2xl p-4 text-white font-bold outline-none focus:ring-2 ring-blue-600 transition-all appearance-none\"\n+//                   style={{ colorScheme: \"dark\" }}\n+//                   onChange={(e) => setNewLastPayment(e.target.value)}\n+//                 />\n+//                 <p className=\"text-[9px] text-blue-500/70 font-bold uppercase ml-1 tracking-tighter\">\n+//                   * Actualiza automáticamente el vencimiento a +30 días.\n+//                 </p>\n+//               </div>\n+//               <button\n+//                 type=\"submit\"\n+//                 className=\"w-full py-5 bg-blue-600 text-white rounded-2xl font-black uppercase text-[11px] tracking-widest hover:bg-blue-500 transition-all shadow-xl shadow-blue-900/20\"\n+//               >\n+//                 Guardar Cambios\n+//               </button>\n+//             </form>\n+//           </div>\n+//         </div>\n+//       )}\n+//     </div>\n+//   );\n+// }\n \"use client\";\n \n import React, { useState, useEffect } from \"react\";\n import { auth, db } from \"@/services/firebase\";\n@@ -23,8 +368,9 @@\n   Edit2,\n   X,\n   Users,\n   BookmarkCheck,\n+  Clock, // Icono para registro\n } from \"lucide-react\";\n \n export default function SuperAdminPage() {\n   const [user, setUser] = useState(null);\n@@ -83,9 +429,17 @@\n       const docs = querySnapshot.docs.map((doc) => ({\n         id: doc.id,\n         ...doc.data(),\n       }));\n-      setBarberias(docs);\n+\n+      // --- ORDENAR DESCENDENTE POR FECHA DE CREACIÓN ---\n+      const sortedDocs = docs.sort((a, b) => {\n+        const dateA = convertToDate(a.createdAt) || new Date(0);\n+        const dateB = convertToDate(b.createdAt) || new Date(0);\n+        return dateB - dateA; // Descendente: más reciente primero\n+      });\n+\n+      setBarberias(sortedDocs);\n     } catch (error) {\n       console.error(\"Error cargando barberías:\", error);\n     }\n   };\n@@ -146,11 +500,12 @@\n             <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-blue-500\">\n               Super Admin Panel\n             </span>\n           </div>\n-          <h1 className=\"text-4xl font-black uppercase tracking-tighter  text-white\">\n+          <h1 className=\"text-4xl font-black uppercase tracking-tighter text-white\">\n             Gestión de <span className=\"text-blue-500\">Barberias</span>\n           </h1>\n+          <p className=\"text-slate-500 text-[9px] font-black uppercase mt-1\">Total registradas: {barberias.length}</p>\n         </div>\n         <div className=\"relative group\">\n           <Search\n             className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\"\n@@ -165,11 +520,12 @@\n       </header>\n \n       <main className=\"max-w-7xl mx-auto\">\n         <div className=\"grid grid-cols-1 gap-4\">\n-          {/* HEADER DE TABLA */}\n-          <div className=\"hidden md:grid grid-cols-7 px-8 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500\">\n+          {/* HEADER DE TABLA RESPONSIVE */}\n+          <div className=\"hidden md:grid grid-cols-8 px-8 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500\">\n             <span>Barbería / Info</span>\n+            <span>Registro</span>\n             <span>Estadísticas</span>\n             <span>Plan</span>\n             <span>Estado</span>\n             <span>Último Pago</span>\n@@ -181,28 +537,24 @@\n             const isPaid =\n               b.plan?.paymentStatus === \"paid\" ||\n               isPaymentValid(b.plan?.lastPayment);\n \n-            // ACCESO A LOS ARRAYS: Contamos los barberos y las citas\n-            const totalBarberos = Array.isArray(b.barbers)\n-              ? b.barbers.length\n-              : 0;\n-            const totalCitas = Array.isArray(b.appointments)\n-              ? b.appointments.length\n-              : 0;\n+            const totalBarberos = Array.isArray(b.barbers) ? b.barbers.length : 0;\n+            const totalCitas = Array.isArray(b.appointments) ? b.appointments.length : 0;\n \n             return (\n               <div\n                 key={b.id}\n-                className=\"bg-slate-900/50 border border-white/5 rounded-[2.5rem] p-6 md:px-8 flex flex-col md:grid md:grid-cols-7 items-center gap-6 hover:border-blue-500/30 transition-all\"\n+                className=\"bg-slate-900/50 border border-white/5 rounded-[2.5rem] p-6 md:px-8 flex flex-col md:grid md:grid-cols-8 items-center gap-6 hover:border-blue-500/30 transition-all\"\n               >\n                 {/* 1. Nombre e Imagen */}\n                 <div className=\"flex items-center gap-4 w-full truncate\">\n                   <div className=\"size-10 rounded-xl bg-slate-800 border border-white/10 flex items-center justify-center shrink-0\">\n                     {b.logo ? (\n                       <img\n                         src={b.logo}\n                         className=\"w-full aspect-square rounded-lg object-cover\"\n+                        alt=\"logo\"\n                       />\n                     ) : (\n                       <span className=\"font-black text-blue-500\">\n                         {b.businessName?.[0]}\n@@ -218,9 +570,18 @@\n                     </p>\n                   </div>\n                 </div>\n \n-                {/* 2. Estadísticas desde los ARRAYS */}\n+                {/* 2. Fecha de Registro (NUEVO) */}\n+                <div className=\"w-full flex flex-col\">\n+                    <span className=\"text-[8px] font-black text-slate-500 uppercase tracking-tighter md:hidden\">Registro</span>\n+                    <div className=\"flex items-center gap-2 text-[10px] font-bold text-blue-500/80\">\n+                        <Clock size={12} />\n+                        {formatDate(b.createdAt)}\n+                    </div>\n+                </div>\n+\n+                {/* 3. Estadísticas */}\n                 <div className=\"w-full flex gap-4\">\n                   <div className=\"flex flex-col\">\n                     <span className=\"text-[8px] font-black text-slate-500 uppercase tracking-tighter\">\n                       Barberos\n@@ -240,14 +601,14 @@\n                     </div>\n                   </div>\n                 </div>\n \n-                {/* 3. Plan */}\n+                {/* 4. Plan */}\n                 <div className=\"w-full text-[10px] font-black uppercase text-blue-400\">\n                   {b.plan?.type || \"Básico\"}\n                 </div>\n \n-                {/* 4. Estado de Pago */}\n+                {/* 5. Estado de Pago */}\n                 <div className=\"w-full\">\n                   <span\n                     className={`text-[9px] font-black uppercase px-3 py-1 rounded-full border ${\n                       isPaid\n@@ -258,19 +619,19 @@\n                     {isPaid ? \"ACTIVO\" : \"PENDIENTE\"}\n                   </span>\n                 </div>\n \n-                {/* 5. Último Pago */}\n+                {/* 6. Último Pago */}\n                 <div className=\"w-full text-[11px] font-bold text-slate-400\">\n                   {formatDate(b.plan?.lastPayment)}\n                 </div>\n \n-                {/* 6. Próximo Pago */}\n+                {/* 7. Próximo Pago */}\n                 <div className=\"w-full text-[11px] font-bold text-white\">\n                   {formatDate(b.plan?.nextPayment)}\n                 </div>\n \n-                {/* 7. Botones */}\n+                {/* 8. Botones */}\n                 <div className=\"flex justify-end w-full gap-2\">\n                   <button\n                     onClick={() => {\n                       setEditingBarberia(b);\n@@ -325,11 +686,8 @@\n                   className=\"w-full bg-slate-800 border border-white/10 rounded-2xl p-4 text-white font-bold outline-none focus:ring-2 ring-blue-600 transition-all appearance-none\"\n                   style={{ colorScheme: \"dark\" }}\n                   onChange={(e) => setNewLastPayment(e.target.value)}\n                 />\n-                <p className=\"text-[9px] text-blue-500/70 font-bold uppercase ml-1 tracking-tighter\">\n-                  * Actualiza automáticamente el vencimiento a +30 días.\n-                </p>\n               </div>\n               <button\n                 type=\"submit\"\n                 className=\"w-full py-5 bg-blue-600 text-white rounded-2xl font-black uppercase text-[11px] tracking-widest hover:bg-blue-500 transition-all shadow-xl shadow-blue-900/20\"\n@@ -341,5 +699,5 @@\n         </div>\n       )}\n     </div>\n   );\n-}\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1767149603008,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -359,18 +359,18 @@\n   ShieldCheck,\n   Search,\n   ExternalLink,\n   Loader2,\n-  AlertOctagon,\n-  CheckCircle2,\n-  CreditCard,\n-  Calendar,\n   Lock,\n   Edit2,\n   X,\n   Users,\n   BookmarkCheck,\n-  Clock, // Icono para registro\n+  Clock,\n+  TrendingUp,\n+  DollarSign,\n+  Calendar,\n+  ChevronRight\n } from \"lucide-react\";\n \n export default function SuperAdminPage() {\n   const [user, setUser] = useState(null);\n@@ -380,8 +380,9 @@\n   const [searchTerm, setSearchTerm] = useState(\"\");\n \n   const [editingBarberia, setEditingBarberia] = useState(null);\n   const [newLastPayment, setNewLastPayment] = useState(\"\");\n+  const [isUpdating, setIsUpdating] = useState(false);\n \n   const ADMIN_EMAIL = process.env.NEXT_PUBLIC_ADMIN_EMAIL;\n \n   const convertToDate = (dateValue) => {\n@@ -430,13 +431,12 @@\n         id: doc.id,\n         ...doc.data(),\n       }));\n \n-      // --- ORDENAR DESCENDENTE POR FECHA DE CREACIÓN ---\n       const sortedDocs = docs.sort((a, b) => {\n         const dateA = convertToDate(a.createdAt) || new Date(0);\n         const dateB = convertToDate(b.createdAt) || new Date(0);\n-        return dateB - dateA; // Descendente: más reciente primero\n+        return dateB - dateA;\n       });\n \n       setBarberias(sortedDocs);\n     } catch (error) {\n@@ -447,8 +447,9 @@\n   const handleManualUpdate = async (e) => {\n     e.preventDefault();\n     if (!editingBarberia || !newLastPayment) return;\n \n+    setIsUpdating(true);\n     try {\n       const lastPayDate = new Date(newLastPayment);\n       const nextPayDate = new Date(lastPayDate);\n       nextPayDate.setDate(lastPayDate.getDate() + 30);\n@@ -461,11 +462,12 @@\n       });\n \n       setEditingBarberia(null);\n       await fetchBarberias();\n-      alert(\"Barbería actualizada correctamente\");\n     } catch (error) {\n       alert(\"Error al actualizar\");\n+    } finally {\n+      setIsUpdating(false);\n     }\n   };\n \n   const filteredBarberias = barberias.filter(\n@@ -497,215 +499,188 @@\n         <div>\n           <div className=\"flex items-center gap-2 mb-2\">\n             <ShieldCheck className=\"text-blue-500\" size={20} />\n             <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-blue-500\">\n-              Super Admin Panel\n+              Super Admin Control\n             </span>\n           </div>\n           <h1 className=\"text-4xl font-black uppercase tracking-tighter text-white\">\n-            Gestión de <span className=\"text-blue-500\">Barberias</span>\n+            Panel <span className=\"text-blue-500\">Maestro</span>\n           </h1>\n-          <p className=\"text-slate-500 text-[9px] font-black uppercase mt-1\">\n-            Total registradas: {barberias.length}\n+          <p className=\"text-slate-500 text-[9px] font-black uppercase mt-1 tracking-widest\">\n+            {barberias.length} locales conectados\n           </p>\n         </div>\n         <div className=\"relative group\">\n-          <Search\n-            className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\"\n-            size={18}\n-          />\n+          <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\" size={18} />\n           <input\n-            placeholder=\"BUSCAR...\"\n-            className=\"bg-slate-900 border border-white/5 rounded-2xl py-4 pl-12 pr-6 w-full md:w-80 text-xs font-bold outline-none focus:border-blue-500 transition-all placeholder:text-slate-600\"\n+            placeholder=\"BUSCAR LOCAL...\"\n+            className=\"bg-slate-900 border border-white/5 rounded-2xl py-4 pl-12 pr-6 w-full md:w-80 text-xs font-bold outline-none focus:border-blue-500 transition-all\"\n             onChange={(e) => setSearchTerm(e.target.value)}\n           />\n         </div>\n       </header>\n \n       <main className=\"max-w-7xl mx-auto\">\n-        <div className=\"grid grid-cols-1 gap-4\">\n-          {/* HEADER DE TABLA RESPONSIVE */}\n-          <div className=\"hidden md:grid grid-cols-8 px-8 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500\">\n-            <span>Barbería / Info</span>\n-            <span>Registro</span>\n-            <span>Estadísticas</span>\n+        <div className=\"grid grid-cols-1 gap-3\">\n+          {/* HEADER TABLA */}\n+          <div className=\"hidden md:grid grid-cols-7 px-8 py-4 text-[9px] font-black uppercase tracking-[0.2em] text-slate-600\">\n+            <span className=\"col-span-2\">Barbería / Registro</span>\n             <span>Plan</span>\n-            <span>Estado</span>\n+            <span>Estado Pago</span>\n             <span>Último Pago</span>\n-            <span>Próximo Venc.</span>\n-            <span className=\"text-right\">Acciones</span>\n+            <span>Vencimiento</span>\n+            <span className=\"text-right pr-4\">Gestión</span>\n           </div>\n \n           {filteredBarberias.map((b) => {\n-            const isPaid =\n-              b.plan?.paymentStatus === \"paid\" ||\n-              isPaymentValid(b.plan?.lastPayment);\n+            const isPaid = b.plan?.paymentStatus === \"paid\" || isPaymentValid(b.plan?.lastPayment);\n \n-            const totalBarberos = Array.isArray(b.barbers)\n-              ? b.barbers.length\n-              : 0;\n-            const totalCitas = Array.isArray(b.appointments)\n-              ? b.appointments.length\n-              : 0;\n-\n             return (\n               <div\n                 key={b.id}\n-                className=\"bg-slate-900/50 border border-white/5 rounded-[2.5rem] p-6 md:px-8 flex flex-col md:grid md:grid-cols-8 items-center gap-6 hover:border-blue-500/30 transition-all\"\n+                className=\"bg-slate-900/40 border border-white/5 rounded-[2rem] p-5 md:px-8 flex flex-col md:grid md:grid-cols-7 items-center gap-6 hover:bg-slate-900/60 transition-all border-l-4 border-l-transparent hover:border-l-blue-500 group\"\n               >\n-                {/* 1. Nombre e Imagen */}\n-                <div className=\"flex items-center gap-4 w-full truncate\">\n-                  <div className=\"size-10 rounded-xl bg-slate-800 border border-white/10 flex items-center justify-center shrink-0\">\n+                <div className=\"col-span-2 flex items-center gap-4 w-full\">\n+                  <div className=\"size-10 rounded-xl bg-slate-800 flex items-center justify-center shrink-0 border border-white/5 group-hover:border-blue-500/50 transition-all overflow-hidden\">\n                     {b.logo ? (\n-                      <img\n-                        src={b.logo}\n-                        className=\"w-full aspect-square rounded-lg object-cover\"\n-                        alt=\"logo\"\n-                      />\n+                      <img src={b.logo} className=\"w-full h-full object-cover\" />\n                     ) : (\n-                      <span className=\"font-black text-blue-500\">\n-                        {b.businessName?.[0]}\n-                      </span>\n+                      <span className=\"font-black text-blue-500\">{b.businessName?.[0]}</span>\n                     )}\n                   </div>\n-                  <div className=\"truncate text-left\">\n-                    <p className=\"font-black uppercase text-xs text-white truncate\">\n-                      {b.businessName}\n-                    </p>\n-                    <p className=\"text-[9px] text-slate-500 font-bold truncate\">\n-                      {b.email}\n-                    </p>\n-                  </div>\n-                </div>\n-\n-                {/* 2. Fecha de Registro (NUEVO) */}\n-                <div className=\"w-full flex flex-col\">\n-                  <span className=\"text-[8px] font-black text-slate-500 uppercase tracking-tighter md:hidden\">\n-                    Registro\n-                  </span>\n-                  <div className=\"flex items-center gap-2 text-[10px] font-bold text-blue-500/80\">\n-                    <Clock size={12} />\n-                    {formatDate(b.createdAt)}\n-                  </div>\n-                </div>\n-\n-                {/* 3. Estadísticas */}\n-                <div className=\"w-full flex gap-4\">\n-                  <div className=\"flex flex-col\">\n-                    <span className=\"text-[8px] font-black text-slate-500 uppercase tracking-tighter\">\n-                      Barberos\n-                    </span>\n-                    <div className=\"flex items-center gap-1 text-xs font-black text-white\">\n-                      <Users size={12} className=\"text-blue-500\" />{\" \"}\n-                      {totalBarberos}\n+                  <div className=\"truncate\">\n+                    <p className=\"font-black uppercase text-xs text-white truncate leading-none mb-1.5\">{b.businessName}</p>\n+                    <div className=\"flex items-center gap-2 text-[9px] font-bold text-slate-500 uppercase\">\n+                      <Clock size={10} /> {formatDate(b.createdAt)}\n                     </div>\n                   </div>\n-                  <div className=\"flex flex-col\">\n-                    <span className=\"text-[8px] font-black text-slate-500 uppercase tracking-tighter\">\n-                      Citas\n-                    </span>\n-                    <div className=\"flex items-center gap-1 text-xs font-black text-white\">\n-                      <BookmarkCheck size={12} className=\"text-emerald-500\" />{\" \"}\n-                      {totalCitas}\n-                    </div>\n-                  </div>\n                 </div>\n \n-                {/* 4. Plan */}\n-                <div className=\"w-full text-[10px] font-black uppercase text-blue-400\">\n+                <div className=\"w-full text-[10px] font-black uppercase text-blue-400/80\">\n                   {b.plan?.type || \"Básico\"}\n                 </div>\n \n-                {/* 5. Estado de Pago */}\n                 <div className=\"w-full\">\n-                  <span\n-                    className={`text-[9px] font-black uppercase px-3 py-1 rounded-full border ${\n-                      isPaid\n-                        ? \"text-emerald-500 border-emerald-500/20 bg-emerald-500/5\"\n-                        : \"text-amber-500 border-amber-500/20 bg-amber-500/5\"\n-                    }`}\n-                  >\n-                    {isPaid ? \"ACTIVO\" : \"PENDIENTE\"}\n+                  <span className={`text-[9px] font-black uppercase px-3 py-1 rounded-full ${isPaid ? \"text-emerald-500 bg-emerald-500/10\" : \"text-amber-500 bg-amber-500/10\"}`}>\n+                    {isPaid ? \"Activo\" : \"Pendiente\"}\n                   </span>\n                 </div>\n \n-                {/* 6. Último Pago */}\n-                <div className=\"w-full text-[11px] font-bold text-slate-400\">\n+                <div className=\"w-full text-[11px] font-bold text-slate-500\">\n                   {formatDate(b.plan?.lastPayment)}\n                 </div>\n \n-                {/* 7. Próximo Pago */}\n-                <div className=\"w-full text-[11px] font-bold text-white\">\n+                <div className=\"w-full text-[11px] font-bold text-slate-300\">\n                   {formatDate(b.plan?.nextPayment)}\n                 </div>\n \n-                {/* 8. Botones */}\n                 <div className=\"flex justify-end w-full gap-2\">\n                   <button\n-                    onClick={() => {\n-                      setEditingBarberia(b);\n-                      setNewLastPayment(\"\");\n-                    }}\n-                    className=\"p-3 bg-slate-800 border border-white/5 hover:border-blue-500 rounded-xl transition-all\"\n+                    onClick={() => { setEditingBarberia(b); setNewLastPayment(\"\"); }}\n+                    className=\"flex items-center gap-2 px-4 py-2.5 bg-blue-600/10 text-blue-500 hover:bg-blue-600 hover:text-white rounded-xl font-black text-[9px] uppercase tracking-widest transition-all\"\n                   >\n-                    <Edit2 size={16} className=\"text-slate-400\" />\n+                    <Edit2 size={14} /> Gestionar\n                   </button>\n-                  <a\n-                    href={`/reserva/${b.id}`}\n-                    target=\"_blank\"\n-                    className=\"p-3 bg-slate-800 border border-white/5 hover:bg-blue-600 rounded-xl transition-all text-slate-400 hover:text-white\"\n-                  >\n-                    <ExternalLink size={16} />\n-                  </a>\n+                  <a href={`/reserva/${b.id}`} target=\"_blank\" className=\"p-2.5 bg-slate-800 text-slate-500 hover:text-white rounded-xl transition-all\"><ExternalLink size={16} /></a>\n                 </div>\n               </div>\n             );\n           })}\n         </div>\n       </main>\n \n-      {/* MODAL DE EDICIÓN MANUAL */}\n+      {/* MODAL DE DETALLE Y ESTADÍSTICAS */}\n       {editingBarberia && (\n-        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-6\">\n-          <div\n-            className=\"absolute inset-0 bg-black/80 backdrop-blur-sm\"\n-            onClick={() => setEditingBarberia(null)}\n-          ></div>\n-          <div className=\"bg-slate-900 border border-white/10 w-full max-w-md rounded-[2.5rem] p-8 relative z-10 shadow-2xl animate-in zoom-in-95\">\n-            <button\n-              onClick={() => setEditingBarberia(null)}\n-              className=\"absolute right-6 top-6 text-slate-500 hover:text-white\"\n-            >\n-              <X size={20} />\n-            </button>\n-            <h3 className=\"text-xl font-black uppercase italic mb-2 text-white\">\n-              Editar <span className=\"text-blue-500\">Pago</span>\n-            </h3>\n-            <p className=\"text-slate-400 text-[10px] font-bold uppercase mb-6 tracking-widest\">\n-              {editingBarberia.businessName}\n-            </p>\n-            <form onSubmit={handleManualUpdate} className=\"space-y-6\">\n-              <div className=\"space-y-2\">\n-                <label className=\"text-[10px] font-black uppercase text-slate-500 ml-1 tracking-widest\">\n-                  Fecha del último pago\n-                </label>\n-                <input\n-                  type=\"date\"\n-                  required\n-                  className=\"w-full bg-slate-800 border border-white/10 rounded-2xl p-4 text-white font-bold outline-none focus:ring-2 ring-blue-600 transition-all appearance-none\"\n-                  style={{ colorScheme: \"dark\" }}\n-                  onChange={(e) => setNewLastPayment(e.target.value)}\n-                />\n-              </div>\n-              <button\n-                type=\"submit\"\n-                className=\"w-full py-5 bg-blue-600 text-white rounded-2xl font-black uppercase text-[11px] tracking-widest hover:bg-blue-500 transition-all shadow-xl shadow-blue-900/20\"\n-              >\n-                Guardar Cambios\n-              </button>\n-            </form>\n+        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n+          <div className=\"absolute inset-0 bg-black/90 backdrop-blur-md\" onClick={() => setEditingBarberia(null)} />\n+          \n+          <div className=\"bg-slate-900 border border-white/10 w-full max-w-2xl rounded-[3rem] p-8 md:p-12 relative z-10 shadow-2xl overflow-y-auto max-h-[90vh] animate-in slide-in-from-bottom-4 duration-300\">\n+            <button onClick={() => setEditingBarberia(null)} className=\"absolute right-8 top-8 text-slate-500 hover:text-white transition-colors\"><X size={24} /></button>\n+            \n+            <header className=\"mb-10 text-center md:text-left\">\n+               <div className=\"size-20 bg-blue-600/10 rounded-3xl flex items-center justify-center mx-auto md:mx-0 mb-6 border border-blue-500/20\">\n+                  {editingBarberia.logo ? (\n+                    <img src={editingBarberia.logo} className=\"w-full h-full object-cover rounded-2xl\" />\n+                  ) : (\n+                    <span className=\"text-3xl font-black text-blue-500\">{editingBarberia.businessName?.[0]}</span>\n+                  )}\n+               </div>\n+               <h3 className=\"text-3xl font-black uppercase italic text-white tracking-tighter leading-none mb-2\">\n+                 {editingBarberia.businessName}\n+               </h3>\n+               <p className=\"text-slate-500 text-xs font-bold uppercase tracking-widest mb-6\">UID: {editingBarberia.id}</p>\n+            </header>\n+\n+            {/* SECCIÓN DE ESTADÍSTICAS REALES */}\n+            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 mb-10\">\n+               <div className=\"bg-slate-800/40 p-6 rounded-3xl border border-white/5\">\n+                  <div className=\"flex items-center gap-2 text-blue-500 mb-2\">\n+                    <Users size={18} />\n+                    <span className=\"text-[10px] font-black uppercase tracking-widest\">Barberos</span>\n+                  </div>\n+                  <p className=\"text-3xl font-black text-white italic\">{Array.isArray(editingBarberia.barbers) ? editingBarberia.barbers.length : 0}</p>\n+               </div>\n+\n+               <div className=\"bg-slate-800/40 p-6 rounded-3xl border border-white/5\">\n+                  <div className=\"flex items-center gap-2 text-emerald-500 mb-2\">\n+                    <BookmarkCheck size={18} />\n+                    <span className=\"text-[10px] font-black uppercase tracking-widest\">Citas Totales</span>\n+                  </div>\n+                  <p className=\"text-3xl font-black text-white italic\">{Array.isArray(editingBarberia.appointments) ? editingBarberia.appointments.length : 0}</p>\n+               </div>\n+\n+               <div className=\"col-span-2 md:col-span-1 bg-blue-600 p-6 rounded-3xl flex flex-col justify-between\">\n+                  <span className=\"text-[10px] font-black uppercase tracking-widest text-white/70\">Plan Actual</span>\n+                  <p className=\"text-2xl font-black text-white uppercase italic mt-2\">{editingBarberia.plan?.type || \"Básico\"}</p>\n+               </div>\n+            </div>\n+\n+            {/* ANALÍTICA RÁPIDA */}\n+            <div className=\"bg-slate-800/20 border border-white/5 p-8 rounded-[2.5rem] mb-10\">\n+               <div className=\"flex items-center justify-between mb-6\">\n+                  <h4 className=\"text-[10px] font-black uppercase tracking-widest text-slate-400\">Rendimiento Histórico</h4>\n+                  <TrendingUp size={16} className=\"text-blue-500\" />\n+               </div>\n+               <div className=\"flex items-end gap-2 h-24 mb-4\">\n+                  {[40, 60, 45, 90, 65, 80, 100].map((h, i) => (\n+                    <div key={i} className=\"flex-1 bg-blue-600/10 rounded-lg relative group\">\n+                      <div style={{ height: `${h}%` }} className=\"bg-blue-600/40 group-hover:bg-blue-600 transition-all rounded-lg w-full\" />\n+                    </div>\n+                  ))}\n+               </div>\n+               <div className=\"flex justify-between text-[9px] font-black text-slate-600 uppercase\">\n+                  <span>Inicios</span><span>Reciente</span>\n+               </div>\n+            </div>\n+\n+            {/* GESTIÓN DE PAGO */}\n+            <div className=\"bg-white/5 p-8 rounded-[2.5rem]\">\n+              <h4 className=\"text-xs font-black uppercase text-white mb-6 flex items-center gap-2 italic\">\n+                <DollarSign size={16} className=\"text-emerald-500\" /> Actualizar Ciclo de Pago\n+              </h4>\n+              <form onSubmit={handleManualUpdate} className=\"space-y-6\">\n+                <div className=\"space-y-3\">\n+                  <label className=\"text-[10px] font-black uppercase text-slate-500 ml-1\">Fecha del último pago recibido</label>\n+                  <input\n+                    type=\"date\"\n+                    required\n+                    className=\"w-full bg-slate-900 border border-white/10 rounded-2xl p-5 text-white font-bold outline-none focus:ring-2 ring-blue-600 transition-all\"\n+                    style={{ colorScheme: \"dark\" }}\n+                    onChange={(e) => setNewLastPayment(e.target.value)}\n+                  />\n+                </div>\n+                <button\n+                  type=\"submit\"\n+                  disabled={isUpdating}\n+                  className=\"w-full py-5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl font-black uppercase text-xs tracking-widest transition-all shadow-xl shadow-blue-900/40 disabled:opacity-50 flex items-center justify-center gap-3\"\n+                >\n+                  {isUpdating ? <Loader2 className=\"animate-spin\" size={20} /> : \"Actualizar Barbería\"}\n+                </button>\n+              </form>\n+            </div>\n           </div>\n         </div>\n       )}\n     </div>\n   );\n-}\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1767149776681,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -352,8 +352,9 @@\n   collection,\n   getDocs,\n   doc,\n   updateDoc,\n+  deleteDoc, // Nuevo para borrar\n   Timestamp,\n } from \"firebase/firestore\";\n import {\n   ShieldCheck,\n@@ -367,10 +368,10 @@\n   BookmarkCheck,\n   Clock,\n   TrendingUp,\n   DollarSign,\n-  Calendar,\n-  ChevronRight,\n+  Trash2, // Nuevo icono\n+  AlertTriangle\n } from \"lucide-react\";\n \n export default function SuperAdminPage() {\n   const [user, setUser] = useState(null);\n@@ -381,8 +382,9 @@\n \n   const [editingBarberia, setEditingBarberia] = useState(null);\n   const [newLastPayment, setNewLastPayment] = useState(\"\");\n   const [isUpdating, setIsUpdating] = useState(false);\n+  const [isDeleting, setIsDeleting] = useState(false);\n \n   const ADMIN_EMAIL = process.env.NEXT_PUBLIC_ADMIN_EMAIL;\n \n   const convertToDate = (dateValue) => {\n@@ -394,13 +396,9 @@\n \n   const formatDate = (dateValue) => {\n     const date = convertToDate(dateValue);\n     if (!date || isNaN(date.getTime())) return \"--/--/----\";\n-    return date.toLocaleDateString(\"es-ES\", {\n-      day: \"2-digit\",\n-      month: \"short\",\n-      year: \"numeric\",\n-    });\n+    return date.toLocaleDateString(\"es-ES\", { day: \"2-digit\", month: \"short\", year: \"numeric\" });\n   };\n \n   const isPaymentValid = (lastPayment) => {\n     const date = convertToDate(lastPayment);\n@@ -426,107 +424,88 @@\n \n   const fetchBarberias = async () => {\n     try {\n       const querySnapshot = await getDocs(collection(db, \"barberias\"));\n-      const docs = querySnapshot.docs.map((doc) => ({\n-        id: doc.id,\n-        ...doc.data(),\n-      }));\n+      const docs = querySnapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));\n+      const sortedDocs = docs.sort((a, b) => (convertToDate(b.createdAt) || 0) - (convertToDate(a.createdAt) || 0));\n+      setBarberias(sortedDocs);\n+    } catch (error) { console.error(\"Error:\", error); }\n+  };\n \n-      const sortedDocs = docs.sort((a, b) => {\n-        const dateA = convertToDate(a.createdAt) || new Date(0);\n-        const dateB = convertToDate(b.createdAt) || new Date(0);\n-        return dateB - dateA;\n-      });\n+  // --- FUNCIÓN PARA ELIMINAR BARBERÍA ---\n+  const handleDeleteBarberia = async (id, name) => {\n+    const confirmName = window.prompt(`Para eliminar \"${name}\", escribe ELIMINAR abajo. Esta acción borrará todos los datos de Firestore.`);\n+    \n+    if (confirmName !== \"ELIMINAR\") return;\n \n-      setBarberias(sortedDocs);\n+    setIsDeleting(true);\n+    try {\n+      // 1. Borrar de Firestore\n+      await deleteDoc(doc(db, \"barberias\", id));\n+      \n+      // 2. Nota sobre Auth\n+      // IMPORTANTE: Para borrar el usuario de Auth desde aquí sin ser el usuario logueado,\n+      // necesitarías llamar a una API propia (Firebase Functions). \n+      // Si no tienes el backend configurado, el usuario quedará en Auth pero sin datos en la App.\n+      \n+      alert(`Barbería \"${name}\" eliminada de la base de datos. Recuerda borrar manualmente el usuario en Firebase Auth con el UID: ${id}`);\n+      \n+      setEditingBarberia(null);\n+      await fetchBarberias();\n     } catch (error) {\n-      console.error(\"Error cargando barberías:\", error);\n+      alert(\"Error al intentar eliminar.\");\n+    } finally {\n+      setIsDeleting(false);\n     }\n   };\n \n   const handleManualUpdate = async (e) => {\n     e.preventDefault();\n     if (!editingBarberia || !newLastPayment) return;\n-\n     setIsUpdating(true);\n     try {\n       const lastPayDate = new Date(newLastPayment);\n       const nextPayDate = new Date(lastPayDate);\n       nextPayDate.setDate(lastPayDate.getDate() + 30);\n-\n       const docRef = doc(db, \"barberias\", editingBarberia.id);\n       await updateDoc(docRef, {\n         \"plan.lastPayment\": Timestamp.fromDate(lastPayDate),\n         \"plan.nextPayment\": Timestamp.fromDate(nextPayDate),\n         \"plan.paymentStatus\": \"paid\",\n       });\n-\n       setEditingBarberia(null);\n       await fetchBarberias();\n-    } catch (error) {\n-      alert(\"Error al actualizar\");\n-    } finally {\n-      setIsUpdating(false);\n-    }\n+    } catch (error) { alert(\"Error al actualizar\"); }\n+    finally { setIsUpdating(false); }\n   };\n \n-  const filteredBarberias = barberias.filter(\n-    (b) =>\n-      b.businessName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n-      b.email?.toLowerCase().includes(searchTerm.toLowerCase())\n+  const filteredBarberias = barberias.filter(b => \n+    b.businessName?.toLowerCase().includes(searchTerm.toLowerCase()) || \n+    b.email?.toLowerCase().includes(searchTerm.toLowerCase())\n   );\n \n-  if (loading)\n-    return (\n-      <div className=\"h-screen flex items-center justify-center bg-[#0a0f1a]\">\n-        <Loader2 className=\"animate-spin text-blue-500\" size={40} />\n-      </div>\n-    );\n+  if (loading) return <div className=\"h-screen flex items-center justify-center bg-[#0a0f1a]\"><Loader2 className=\"animate-spin text-blue-500\" size={40} /></div>;\n \n-  if (!isAuthorized)\n-    return (\n-      <div className=\"h-screen flex flex-col items-center justify-center bg-[#0a0f1a] p-6 text-center\">\n-        <Lock className=\"text-red-500 mb-6\" size={40} />\n-        <h1 className=\"text-2xl font-black text-white uppercase tracking-tighter\">\n-          Acceso Denegado\n-        </h1>\n-      </div>\n-    );\n+  if (!isAuthorized) return <div className=\"h-screen flex flex-col items-center justify-center bg-[#0a0f1a] p-6 text-center\"><Lock className=\"text-red-500 mb-6\" size={40} /><h1 className=\"text-2xl font-black text-white uppercase tracking-tighter\">Acceso Denegado</h1></div>;\n \n   return (\n     <div className=\"min-h-screen bg-[#0a0f1a] text-slate-100 p-6 md:p-12 relative\">\n       <header className=\"max-w-7xl mx-auto mb-12 flex flex-col md:flex-row md:items-center justify-between gap-6\">\n         <div>\n           <div className=\"flex items-center gap-2 mb-2\">\n             <ShieldCheck className=\"text-blue-500\" size={20} />\n-            <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-blue-500\">\n-              Super Admin Control\n-            </span>\n+            <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-blue-500\">Super Admin Control</span>\n           </div>\n-          <h1 className=\"text-4xl font-black uppercase tracking-tighter text-white\">\n-            Panel <span className=\"text-blue-500\">Maestro</span>\n-          </h1>\n-          <p className=\"text-slate-500 text-[9px] font-black uppercase mt-1 tracking-widest\">\n-            {barberias.length} locales conectados\n-          </p>\n+          <h1 className=\"text-4xl font-black uppercase tracking-tighter text-white\">Panel <span className=\"text-blue-500\">Maestro</span></h1>\n         </div>\n         <div className=\"relative group\">\n-          <Search\n-            className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\"\n-            size={18}\n-          />\n-          <input\n-            placeholder=\"BUSCAR LOCAL...\"\n-            className=\"bg-slate-900 border border-white/5 rounded-2xl py-4 pl-12 pr-6 w-full md:w-80 text-xs font-bold outline-none focus:border-blue-500 transition-all\"\n-            onChange={(e) => setSearchTerm(e.target.value)}\n-          />\n+          <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\" size={18} />\n+          <input placeholder=\"BUSCAR LOCAL...\" className=\"bg-slate-900 border border-white/5 rounded-2xl py-4 pl-12 pr-6 w-full md:w-80 text-xs font-bold outline-none focus:border-blue-500 transition-all\" onChange={(e) => setSearchTerm(e.target.value)} />\n         </div>\n       </header>\n \n       <main className=\"max-w-7xl mx-auto\">\n         <div className=\"grid grid-cols-1 gap-3\">\n-          {/* HEADER TABLA */}\n           <div className=\"hidden md:grid grid-cols-7 px-8 py-4 text-[9px] font-black uppercase tracking-[0.2em] text-slate-600\">\n             <span className=\"col-span-2\">Barbería / Registro</span>\n             <span>Plan</span>\n             <span>Estado Pago</span>\n@@ -535,226 +514,101 @@\n             <span className=\"text-right pr-4\">Gestión</span>\n           </div>\n \n           {filteredBarberias.map((b) => {\n-            const isPaid =\n-              b.plan?.paymentStatus === \"paid\" ||\n-              isPaymentValid(b.plan?.lastPayment);\n-\n+            const isPaid = b.plan?.paymentStatus === \"paid\" || isPaymentValid(b.plan?.lastPayment);\n             return (\n-              <div\n-                key={b.id}\n-                className=\"bg-slate-900/40 border border-white/5 rounded-[2rem] p-5 md:px-8 flex flex-col md:grid md:grid-cols-7 items-center gap-6 hover:bg-slate-900/60 transition-all border-l-4 border-l-transparent hover:border-l-blue-500 group\"\n-              >\n+              <div key={b.id} className=\"bg-slate-900/40 border border-white/5 rounded-[2rem] p-5 md:px-8 flex flex-col md:grid md:grid-cols-7 items-center gap-6 hover:bg-slate-900/60 transition-all border-l-4 border-l-transparent hover:border-l-blue-500 group\">\n                 <div className=\"col-span-2 flex items-center gap-4 w-full\">\n-                  <div className=\"size-10 rounded-xl bg-slate-800 flex items-center justify-center shrink-0 border border-white/5 group-hover:border-blue-500/50 transition-all overflow-hidden\">\n-                    {b.logo ? (\n-                      <img\n-                        src={b.logo}\n-                        className=\"w-full h-full object-cover\"\n-                      />\n-                    ) : (\n-                      <span className=\"font-black text-blue-500\">\n-                        {b.businessName?.[0]}\n-                      </span>\n-                    )}\n+                  <div className=\"size-10 rounded-xl bg-slate-800 flex items-center justify-center shrink-0 border border-white/5 overflow-hidden\">\n+                    {b.logo ? <img src={b.logo} className=\"w-full h-full object-cover\" /> : <span className=\"font-black text-blue-500\">{b.businessName?.[0]}</span>}\n                   </div>\n                   <div className=\"truncate\">\n-                    <p className=\"font-black uppercase text-xs text-white truncate leading-none mb-1.5\">\n-                      {b.businessName}\n-                    </p>\n-                    <div className=\"flex items-center gap-2 text-[9px] font-bold text-slate-500 uppercase\">\n-                      <Clock size={10} /> {formatDate(b.createdAt)}\n-                    </div>\n+                    <p className=\"font-black uppercase text-xs text-white truncate leading-none mb-1.5\">{b.businessName}</p>\n+                    <div className=\"flex items-center gap-2 text-[9px] font-bold text-slate-500 uppercase\"><Clock size={10} /> {formatDate(b.createdAt)}</div>\n                   </div>\n                 </div>\n-\n-                <div className=\"w-full text-[10px] font-black uppercase text-blue-400/80\">\n-                  {b.plan?.type || \"Básico\"}\n-                </div>\n-\n-                <div className=\"w-full\">\n-                  <span\n-                    className={`text-[9px] font-black uppercase px-3 py-1 rounded-full ${\n-                      isPaid\n-                        ? \"text-emerald-500 bg-emerald-500/10\"\n-                        : \"text-amber-500 bg-amber-500/10\"\n-                    }`}\n-                  >\n-                    {isPaid ? \"Activo\" : \"Pendiente\"}\n-                  </span>\n-                </div>\n-\n-                <div className=\"w-full text-[11px] font-bold text-slate-500\">\n-                  {formatDate(b.plan?.lastPayment)}\n-                </div>\n-\n-                <div className=\"w-full text-[11px] font-bold text-slate-300\">\n-                  {formatDate(b.plan?.nextPayment)}\n-                </div>\n-\n+                <div className=\"w-full text-[10px] font-black uppercase text-blue-400/80\">{b.plan?.type || \"Básico\"}</div>\n+                <div className=\"w-full\"><span className={`text-[9px] font-black uppercase px-3 py-1 rounded-full ${isPaid ? \"text-emerald-500 bg-emerald-500/10\" : \"text-amber-500 bg-amber-500/10\"}`}>{isPaid ? \"Activo\" : \"Pendiente\"}</span></div>\n+                <div className=\"w-full text-[11px] font-bold text-slate-500\">{formatDate(b.plan?.lastPayment)}</div>\n+                <div className=\"w-full text-[11px] font-bold text-slate-300\">{formatDate(b.plan?.nextPayment)}</div>\n                 <div className=\"flex justify-end w-full gap-2\">\n-                  <button\n-                    onClick={() => {\n-                      setEditingBarberia(b);\n-                      setNewLastPayment(\"\");\n-                    }}\n-                    className=\"flex items-center gap-2 px-4 py-2.5 bg-blue-600/10 text-blue-500 hover:bg-blue-600 hover:text-white rounded-xl font-black text-[9px] uppercase tracking-widest transition-all\"\n-                  >\n-                    <Edit2 size={14} /> Gestionar\n-                  </button>\n-                  <a\n-                    href={`/reserva/${b.id}`}\n-                    target=\"_blank\"\n-                    className=\"p-2.5 bg-slate-800 text-slate-500 hover:text-white rounded-xl transition-all\"\n-                  >\n-                    <ExternalLink size={16} />\n-                  </a>\n+                  <button onClick={() => { setEditingBarberia(b); setNewLastPayment(\"\"); }} className=\"flex items-center gap-2 px-4 py-2.5 bg-blue-600/10 text-blue-500 hover:bg-blue-600 hover:text-white rounded-xl font-black text-[9px] uppercase tracking-widest transition-all\"><Edit2 size={14} /> Gestionar</button>\n                 </div>\n               </div>\n             );\n           })}\n         </div>\n       </main>\n \n-      {/* MODAL DE DETALLE Y ESTADÍSTICAS */}\n+      {/* MODAL DE DETALLE Y ELIMINACIÓN */}\n       {editingBarberia && (\n         <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n-          <div\n-            className=\"absolute inset-0 bg-black/90 backdrop-blur-md\"\n-            onClick={() => setEditingBarberia(null)}\n-          />\n-\n-          <div className=\"bg-slate-900 border border-white/10 w-full max-w-2xl rounded-[3rem] p-8 md:p-12 relative z-10 shadow-2xl overflow-y-auto max-h-[90vh] animate-in slide-in-from-bottom-4 duration-300\">\n-            <button\n-              onClick={() => setEditingBarberia(null)}\n-              className=\"absolute right-8 top-8 text-slate-500 hover:text-white transition-colors\"\n-            >\n-              <X size={24} />\n-            </button>\n-\n-            <header className=\"mb-10 text-center md:text-left\">\n-              <div className=\"size-20 bg-blue-600/10 rounded-3xl flex items-center justify-center mx-auto md:mx-0 mb-6 border border-blue-500/20\">\n-                {editingBarberia.logo ? (\n-                  <img\n-                    src={editingBarberia.logo}\n-                    className=\"w-full h-full object-cover rounded-2xl\"\n-                  />\n-                ) : (\n-                  <span className=\"text-3xl font-black text-blue-500\">\n-                    {editingBarberia.businessName?.[0]}\n-                  </span>\n-                )}\n-              </div>\n-              <h3 className=\"text-3xl font-black uppercase italic text-white tracking-tighter leading-none mb-2\">\n-                {editingBarberia.businessName}\n-              </h3>\n-              <p className=\"text-slate-500 text-xs font-bold uppercase tracking-widest mb-6\">\n-                UID: {editingBarberia.id}\n-              </p>\n-            </header>\n-\n-            {/* SECCIÓN DE ESTADÍSTICAS REALES */}\n-            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 mb-10\">\n-              <div className=\"bg-slate-800/40 p-6 rounded-3xl border border-white/5\">\n-                <div className=\"flex items-center gap-2 text-blue-500 mb-2\">\n-                  <Users size={18} />\n-                  <span className=\"text-[10px] font-black uppercase tracking-widest\">\n-                    Barberos\n-                  </span>\n+          <div className=\"absolute inset-0 bg-black/90 backdrop-blur-md\" onClick={() => setEditingBarberia(null)} />\n+          <div className=\"bg-slate-900 border border-white/10 w-full max-w-2xl rounded-[3rem] p-8 md:p-12 relative z-10 shadow-2xl overflow-y-auto max-h-[95vh] animate-in slide-in-from-bottom-4 transition-all\">\n+            \n+            <div className=\"flex justify-between items-start mb-10\">\n+              <div className=\"flex items-center gap-4\">\n+                <div className=\"size-16 bg-blue-600/10 rounded-2xl flex items-center justify-center border border-blue-500/20 overflow-hidden\">\n+                  {editingBarberia.logo ? <img src={editingBarberia.logo} className=\"w-full h-full object-cover\" /> : <span className=\"text-2xl font-black text-blue-500\">{editingBarberia.businessName?.[0]}</span>}\n                 </div>\n-                <p className=\"text-3xl font-black text-white italic\">\n-                  {Array.isArray(editingBarberia.barbers)\n-                    ? editingBarberia.barbers.length\n-                    : 0}\n-                </p>\n-              </div>\n-\n-              <div className=\"bg-slate-800/40 p-6 rounded-3xl border border-white/5\">\n-                <div className=\"flex items-center gap-2 text-emerald-500 mb-2\">\n-                  <BookmarkCheck size={18} />\n-                  <span className=\"text-[10px] font-black uppercase tracking-widest\">\n-                    Citas Totales\n-                  </span>\n+                <div>\n+                  <h3 className=\"text-2xl font-black uppercase italic text-white tracking-tighter leading-none mb-1\">{editingBarberia.businessName}</h3>\n+                  <p className=\"text-slate-500 text-[9px] font-bold uppercase tracking-widest\">{editingBarberia.email}</p>\n                 </div>\n-                <p className=\"text-3xl font-black text-white italic\">\n-                  {Array.isArray(editingBarberia.appointments)\n-                    ? editingBarberia.appointments.length\n-                    : 0}\n-                </p>\n               </div>\n+              <button onClick={() => setEditingBarberia(null)} className=\"p-2 text-slate-500 hover:text-white\"><X size={24} /></button>\n+            </div>\n \n-              <div className=\"col-span-2 md:col-span-1 bg-blue-600 p-6 rounded-3xl flex flex-col justify-between\">\n-                <span className=\"text-[10px] font-black uppercase tracking-widest text-white/70\">\n-                  Plan Actual\n-                </span>\n-                <p className=\"text-2xl font-black text-white uppercase italic mt-2\">\n-                  {editingBarberia.plan?.type || \"Básico\"}\n-                </p>\n-              </div>\n+            {/* SECCIÓN ESTADÍSTICAS (COMO PEDISTE) */}\n+            <div className=\"grid grid-cols-2 gap-4 mb-8\">\n+               <div className=\"bg-slate-800/40 p-6 rounded-3xl border border-white/5\">\n+                  <div className=\"flex items-center gap-2 text-blue-500 mb-2\">\n+                    <Users size={16} /><span className=\"text-[10px] font-black uppercase tracking-widest\">Barberos</span>\n+                  </div>\n+                  <p className=\"text-2xl font-black text-white italic\">{editingBarberia.barbers?.length || 0}</p>\n+               </div>\n+               <div className=\"bg-slate-800/40 p-6 rounded-3xl border border-white/5\">\n+                  <div className=\"flex items-center gap-2 text-emerald-500 mb-2\">\n+                    <BookmarkCheck size={16} /><span className=\"text-[10px] font-black uppercase tracking-widest\">Citas Totales</span>\n+                  </div>\n+                  <p className=\"text-2xl font-black text-white italic\">{editingBarberia.appointments?.length || 0}</p>\n+               </div>\n             </div>\n \n-            {/* ANALÍTICA RÁPIDA */}\n-            <div className=\"bg-slate-800/20 border border-white/5 p-8 rounded-[2.5rem] mb-10\">\n-              <div className=\"flex items-center justify-between mb-6\">\n-                <h4 className=\"text-[10px] font-black uppercase tracking-widest text-slate-400\">\n-                  Rendimiento Histórico\n-                </h4>\n-                <TrendingUp size={16} className=\"text-blue-500\" />\n+            {/* ZONA DE PELIGRO: ELIMINAR BARBERÍA */}\n+            <div className=\"bg-red-500/5 border border-red-500/20 p-8 rounded-[2.5rem] mb-8\">\n+              <div className=\"flex items-center gap-3 text-red-500 mb-4\">\n+                <AlertTriangle size={20} />\n+                <h4 className=\"text-xs font-black uppercase tracking-widest\">Zona de Peligro</h4>\n               </div>\n-              <div className=\"flex items-end gap-2 h-24 mb-4\">\n-                {[40, 60, 45, 90, 65, 80, 100].map((h, i) => (\n-                  <div\n-                    key={i}\n-                    className=\"flex-1 bg-blue-600/10 rounded-lg relative group\"\n-                  >\n-                    <div\n-                      style={{ height: `${h}%` }}\n-                      className=\"bg-blue-600/40 group-hover:bg-blue-600 transition-all rounded-lg w-full\"\n-                    />\n-                  </div>\n-                ))}\n-              </div>\n-              <div className=\"flex justify-between text-[9px] font-black text-slate-600 uppercase\">\n-                <span>Inicios</span>\n-                <span>Reciente</span>\n-              </div>\n+              <p className=\"text-[10px] text-slate-400 font-bold uppercase mb-6 leading-relaxed\">\n+                Esta acción eliminará permanentemente todos los datos de Firestore (citas, barberos, configuración). El usuario deberá ser borrado manualmente de Auth.\n+              </p>\n+              <button \n+                onClick={() => handleDeleteBarberia(editingBarberia.id, editingBarberia.businessName)}\n+                disabled={isDeleting}\n+                className=\"w-full py-4 bg-red-600/10 hover:bg-red-600 text-red-600 hover:text-white rounded-2xl font-black uppercase text-[10px] tracking-widest transition-all border border-red-500/20\"\n+              >\n+                {isDeleting ? <Loader2 className=\"animate-spin mx-auto\" size={18} /> : \"Eliminar Barbería por Completo\"}\n+              </button>\n             </div>\n \n             {/* GESTIÓN DE PAGO */}\n             <div className=\"bg-white/5 p-8 rounded-[2.5rem]\">\n-              <h4 className=\"text-xs font-black uppercase text-white mb-6 flex items-center gap-2 italic\">\n-                <DollarSign size={16} className=\"text-emerald-500\" /> Actualizar\n-                Ciclo de Pago\n-              </h4>\n+              <h4 className=\"text-xs font-black uppercase text-white mb-6 italic\">Actualizar Ciclo de Pago</h4>\n               <form onSubmit={handleManualUpdate} className=\"space-y-6\">\n                 <div className=\"space-y-3\">\n-                  <label className=\"text-[10px] font-black uppercase text-slate-500 ml-1\">\n-                    Fecha del último pago recibido\n-                  </label>\n-                  <input\n-                    type=\"date\"\n-                    required\n-                    className=\"w-full bg-slate-900 border border-white/10 rounded-2xl p-5 text-white font-bold outline-none focus:ring-2 ring-blue-600 transition-all\"\n-                    style={{ colorScheme: \"dark\" }}\n-                    onChange={(e) => setNewLastPayment(e.target.value)}\n-                  />\n+                  <label className=\"text-[10px] font-black uppercase text-slate-500 ml-1\">Fecha del último pago</label>\n+                  <input type=\"date\" required className=\"w-full bg-slate-900 border border-white/10 rounded-2xl p-5 text-white font-bold outline-none focus:ring-2 ring-blue-600 transition-all\" style={{ colorScheme: \"dark\" }} onChange={(e) => setNewLastPayment(e.target.value)} />\n                 </div>\n-                <button\n-                  type=\"submit\"\n-                  disabled={isUpdating}\n-                  className=\"w-full py-5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl font-black uppercase text-xs tracking-widest transition-all shadow-xl shadow-blue-900/40 disabled:opacity-50 flex items-center justify-center gap-3\"\n-                >\n-                  {isUpdating ? (\n-                    <Loader2 className=\"animate-spin\" size={20} />\n-                  ) : (\n-                    \"Actualizar Barbería\"\n-                  )}\n+                <button type=\"submit\" disabled={isUpdating} className=\"w-full py-5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl font-black uppercase text-xs tracking-widest transition-all shadow-xl shadow-blue-900/40\">\n+                  {isUpdating ? <Loader2 className=\"animate-spin mx-auto\" size={20} /> : \"Confirmar Actualización\"}\n                 </button>\n               </form>\n             </div>\n           </div>\n         </div>\n       )}\n     </div>\n   );\n-}\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1767122528782,
            "name": "Commit-0",
            "content": "\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { auth, db } from \"@/services/firebase\";\nimport { onAuthStateChanged } from \"firebase/auth\";\nimport {\n  collection,\n  getDocs,\n  doc,\n  updateDoc,\n  Timestamp,\n} from \"firebase/firestore\";\nimport {\n  ShieldCheck,\n  Search,\n  ExternalLink,\n  Loader2,\n  AlertOctagon,\n  CheckCircle2,\n  CreditCard,\n  Calendar,\n  Lock,\n  Edit2,\n  X,\n  Users,\n  BookmarkCheck,\n} from \"lucide-react\";\n\nexport default function SuperAdminPage() {\n  const [user, setUser] = useState(null);\n  const [barberias, setBarberias] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [isAuthorized, setIsAuthorized] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  const [editingBarberia, setEditingBarberia] = useState(null);\n  const [newLastPayment, setNewLastPayment] = useState(\"\");\n\n  const ADMIN_EMAIL =\n    process.env.NEXT_PUBLIC_ADMIN_EMAIL || \"cleberich@gmail.com\";\n\n  const convertToDate = (dateValue) => {\n    if (!dateValue) return null;\n    if (typeof dateValue.toDate === \"function\") return dateValue.toDate();\n    if (dateValue.seconds) return new Date(dateValue.seconds * 1000);\n    return new Date(dateValue);\n  };\n\n  const formatDate = (dateValue) => {\n    const date = convertToDate(dateValue);\n    if (!date || isNaN(date.getTime())) return \"--/--/----\";\n    return date.toLocaleDateString(\"es-ES\", {\n      day: \"2-digit\",\n      month: \"short\",\n      year: \"numeric\",\n    });\n  };\n\n  const isPaymentValid = (lastPayment) => {\n    const date = convertToDate(lastPayment);\n    if (!date) return false;\n    const today = new Date();\n    const diffInDays = (today.getTime() - date.getTime()) / (1000 * 3600 * 24);\n    return diffInDays <= 30 && diffInDays >= 0;\n  };\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\n      if (currentUser && currentUser.email === ADMIN_EMAIL) {\n        setUser(currentUser);\n        setIsAuthorized(true);\n        await fetchBarberias();\n      } else {\n        setIsAuthorized(false);\n      }\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, []);\n\n  const fetchBarberias = async () => {\n    try {\n      const querySnapshot = await getDocs(collection(db, \"barberias\"));\n      const docs = querySnapshot.docs.map((doc) => ({\n        id: doc.id,\n        ...doc.data(),\n      }));\n      setBarberias(docs);\n    } catch (error) {\n      console.error(\"Error cargando barberías:\", error);\n    }\n  };\n\n  const handleManualUpdate = async (e) => {\n    e.preventDefault();\n    if (!editingBarberia || !newLastPayment) return;\n\n    try {\n      const lastPayDate = new Date(newLastPayment);\n      const nextPayDate = new Date(lastPayDate);\n      nextPayDate.setDate(lastPayDate.getDate() + 30);\n\n      const docRef = doc(db, \"barberias\", editingBarberia.id);\n      await updateDoc(docRef, {\n        \"plan.lastPayment\": Timestamp.fromDate(lastPayDate),\n        \"plan.nextPayment\": Timestamp.fromDate(nextPayDate),\n        \"plan.paymentStatus\": \"paid\",\n      });\n\n      setEditingBarberia(null);\n      await fetchBarberias();\n      alert(\"Barbería actualizada correctamente\");\n    } catch (error) {\n      alert(\"Error al actualizar\");\n    }\n  };\n\n  const filteredBarberias = barberias.filter(\n    (b) =>\n      b.businessName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      b.email?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  if (loading)\n    return (\n      <div className=\"h-screen flex items-center justify-center bg-[#0a0f1a]\">\n        <Loader2 className=\"animate-spin text-blue-500\" size={40} />\n      </div>\n    );\n\n  if (!isAuthorized)\n    return (\n      <div className=\"h-screen flex flex-col items-center justify-center bg-[#0a0f1a] p-6 text-center\">\n        <Lock className=\"text-red-500 mb-6\" size={40} />\n        <h1 className=\"text-2xl font-black text-white uppercase tracking-tighter\">\n          Acceso Denegado\n        </h1>\n      </div>\n    );\n\n  return (\n    <div className=\"min-h-screen bg-[#0a0f1a] text-slate-100 p-6 md:p-12 relative\">\n      <header className=\"max-w-7xl mx-auto mb-12 flex flex-col md:flex-row md:items-center justify-between gap-6\">\n        <div>\n          <div className=\"flex items-center gap-2 mb-2\">\n            <ShieldCheck className=\"text-blue-500\" size={20} />\n            <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-blue-500\">\n              Super Admin Panel\n            </span>\n          </div>\n          <h1 className=\"text-4xl font-black uppercase tracking-tighter italic text-white\">\n            Gestión de <span className=\"text-blue-500\">Barberias</span>\n          </h1>\n        </div>\n        <div className=\"relative group\">\n          <Search\n            className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\"\n            size={18}\n          />\n          <input\n            placeholder=\"BUSCAR...\"\n            className=\"bg-slate-900 border border-white/5 rounded-2xl py-4 pl-12 pr-6 w-full md:w-80 text-xs font-bold outline-none focus:border-blue-500 transition-all placeholder:text-slate-600\"\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto\">\n        <div className=\"grid grid-cols-1 gap-4\">\n          {/* HEADER DE TABLA */}\n          <div className=\"hidden md:grid grid-cols-7 px-8 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500\">\n            <span>Barbería / Info</span>\n            <span>Estadísticas</span>\n            <span>Plan</span>\n            <span>Estado</span>\n            <span>Último Pago</span>\n            <span>Próximo Venc.</span>\n            <span className=\"text-right\">Acciones</span>\n          </div>\n\n          {filteredBarberias.map((b) => {\n            const isPaid =\n              b.plan?.paymentStatus === \"paid\" ||\n              isPaymentValid(b.plan?.lastPayment);\n\n            // ACCESO A LOS ARRAYS: Contamos los barberos y las citas\n            const totalBarberos = Array.isArray(b.barbers)\n              ? b.barbers.length\n              : 0;\n            const totalCitas = Array.isArray(b.appointments)\n              ? b.appointments.length\n              : 0;\n\n            return (\n              <div\n                key={b.id}\n                className=\"bg-slate-900/50 border border-white/5 rounded-[2.5rem] p-6 md:px-8 flex flex-col md:grid md:grid-cols-7 items-center gap-6 hover:border-blue-500/30 transition-all\"\n              >\n                {/* 1. Nombre e Imagen */}\n                <div className=\"flex items-center gap-4 w-full truncate\">\n                  <div className=\"size-10 rounded-xl bg-slate-800 border border-white/10 flex items-center justify-center shrink-0\">\n                    {b.logo ? (\n                      <img\n                        src={b.logo}\n                        className=\"w-full aspect-square rounded-lg object-cover\"\n                      />\n                    ) : (\n                      <span className=\"font-black text-blue-500\">\n                        {b.businessName?.[0]}\n                      </span>\n                    )}\n                  </div>\n                  <div className=\"truncate text-left\">\n                    <p className=\"font-black uppercase text-xs text-white truncate\">\n                      {b.businessName}\n                    </p>\n                    <p className=\"text-[9px] text-slate-500 font-bold truncate\">\n                      {b.email}\n                    </p>\n                  </div>\n                </div>\n\n                {/* 2. Estadísticas desde los ARRAYS */}\n                <div className=\"w-full flex gap-4\">\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-[8px] font-black text-slate-500 uppercase tracking-tighter\">\n                      Barberos\n                    </span>\n                    <div className=\"flex items-center gap-1 text-xs font-black text-white\">\n                      <Users size={12} className=\"text-blue-500\" />{\" \"}\n                      {totalBarberos}\n                    </div>\n                  </div>\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-[8px] font-black text-slate-500 uppercase tracking-tighter\">\n                      Citas\n                    </span>\n                    <div className=\"flex items-center gap-1 text-xs font-black text-white\">\n                      <BookmarkCheck size={12} className=\"text-emerald-500\" />{\" \"}\n                      {totalCitas}\n                    </div>\n                  </div>\n                </div>\n\n                {/* 3. Plan */}\n                <div className=\"w-full text-[10px] font-black uppercase text-blue-400\">\n                  {b.plan?.type || \"Básico\"}\n                </div>\n\n                {/* 4. Estado de Pago */}\n                <div className=\"w-full\">\n                  <span\n                    className={`text-[9px] font-black uppercase px-3 py-1 rounded-full border ${\n                      isPaid\n                        ? \"text-emerald-500 border-emerald-500/20 bg-emerald-500/5\"\n                        : \"text-amber-500 border-amber-500/20 bg-amber-500/5\"\n                    }`}\n                  >\n                    {isPaid ? \"ACTIVO\" : \"PENDIENTE\"}\n                  </span>\n                </div>\n\n                {/* 5. Último Pago */}\n                <div className=\"w-full text-[11px] font-bold text-slate-400\">\n                  {formatDate(b.plan?.lastPayment)}\n                </div>\n\n                {/* 6. Próximo Pago */}\n                <div className=\"w-full text-[11px] font-bold text-white\">\n                  {formatDate(b.plan?.nextPayment)}\n                </div>\n\n                {/* 7. Botones */}\n                <div className=\"flex justify-end w-full gap-2\">\n                  <button\n                    onClick={() => {\n                      setEditingBarberia(b);\n                      setNewLastPayment(\"\");\n                    }}\n                    className=\"p-3 bg-slate-800 border border-white/5 hover:border-blue-500 rounded-xl transition-all\"\n                  >\n                    <Edit2 size={16} className=\"text-slate-400\" />\n                  </button>\n                  <a\n                    href={`/reserva/${b.id}`}\n                    target=\"_blank\"\n                    className=\"p-3 bg-slate-800 border border-white/5 hover:bg-blue-600 rounded-xl transition-all text-slate-400 hover:text-white\"\n                  >\n                    <ExternalLink size={16} />\n                  </a>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </main>\n\n      {/* MODAL DE EDICIÓN MANUAL */}\n      {editingBarberia && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-6\">\n          <div\n            className=\"absolute inset-0 bg-black/80 backdrop-blur-sm\"\n            onClick={() => setEditingBarberia(null)}\n          ></div>\n          <div className=\"bg-slate-900 border border-white/10 w-full max-w-md rounded-[2.5rem] p-8 relative z-10 shadow-2xl animate-in zoom-in-95\">\n            <button\n              onClick={() => setEditingBarberia(null)}\n              className=\"absolute right-6 top-6 text-slate-500 hover:text-white\"\n            >\n              <X size={20} />\n            </button>\n            <h3 className=\"text-xl font-black uppercase italic mb-2 text-white\">\n              Editar <span className=\"text-blue-500\">Pago</span>\n            </h3>\n            <p className=\"text-slate-400 text-[10px] font-bold uppercase mb-6 tracking-widest\">\n              {editingBarberia.businessName}\n            </p>\n            <form onSubmit={handleManualUpdate} className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <label className=\"text-[10px] font-black uppercase text-slate-500 ml-1 tracking-widest\">\n                  Fecha del último pago\n                </label>\n                <input\n                  type=\"date\"\n                  required\n                  className=\"w-full bg-slate-800 border border-white/10 rounded-2xl p-4 text-white font-bold outline-none focus:ring-2 ring-blue-600 transition-all appearance-none\"\n                  style={{ colorScheme: \"dark\" }}\n                  onChange={(e) => setNewLastPayment(e.target.value)}\n                />\n                <p className=\"text-[9px] text-blue-500/70 font-bold uppercase ml-1 tracking-tighter\">\n                  * Actualiza automáticamente el vencimiento a +30 días.\n                </p>\n              </div>\n              <button\n                type=\"submit\"\n                className=\"w-full py-5 bg-blue-600 text-white rounded-2xl font-black uppercase text-[11px] tracking-widest hover:bg-blue-500 transition-all shadow-xl shadow-blue-900/20\"\n              >\n                Guardar Cambios\n              </button>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"
        }
    ]
}