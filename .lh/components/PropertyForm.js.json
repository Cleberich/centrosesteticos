{
    "sourceFile": "components/PropertyForm.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1765953664527,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1765953683269,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -335,9 +335,9 @@\n   const router = useRouter();\n \n   // Carga de Google Maps SDK\n   const { isLoaded } = useJsApiLoader({\n-    googleMapsApiKey: \"TU_API_KEY_AQUI\", // REEMPLAZA ESTO\n+    googleMapsApiKey: \"AIzaSyD8KgUn-IqYYSgnllCyOgDcIPVDdEkel6I\", // REEMPLAZA ESTO\n     libraries: libraries,\n   });\n \n   // Manejo de autocompletado de dirección\n"
                },
                {
                    "date": 1765953782491,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -291,29 +291,18 @@\n import { addDoc, collection, serverTimestamp } from \"firebase/firestore\";\n import { ref, uploadBytes, getDownloadURL } from \"firebase/storage\";\n import { auth, db, storage } from \"@/services/firebase\";\n import { useRouter } from \"next/navigation\";\n-import { useState, useRef, useMemo } from \"react\";\n+import { useState, useRef } from \"react\";\n import Compressor from \"browser-image-compression\";\n import { useJsApiLoader, Autocomplete } from \"@react-google-maps/api\";\n \n const barriosMontevideo = [\n-  \"Pocitos\",\n-  \"Carrasco\",\n-  \"Centro\",\n-  \"Ciudad Vieja\",\n-  \"Buceo\",\n-  \"Malvín\",\n-  \"Punta Carretas\",\n-  \"Prado\",\n-  \"Parque Rodó\",\n-  \"Cordón\",\n-  \"La Blanqueada\",\n-  \"Tres Cruces\",\n-  \"Parque Batlle\",\n+  \"Pocitos\", \"Carrasco\", \"Centro\", \"Ciudad Vieja\", \"Buceo\", \n+  \"Malvín\", \"Punta Carretas\", \"Prado\", \"Parque Rodó\", \n+  \"Cordón\", \"La Blanqueada\", \"Tres Cruces\", \"Parque Batlle\",\n ];\n \n-// Definimos las librerías fuera del componente para evitar re-renders innecesarios\n const libraries = [\"places\"];\n \n export default function PropertyForm() {\n   const [formData, setFormData] = useState({\n@@ -328,29 +317,29 @@\n \n   const [imagenes, setImagenes] = useState([]);\n   const [previewUrls, setPreviewUrls] = useState([]);\n   const [loading, setLoading] = useState(false);\n-\n+  \n   const fileInputRef = useRef(null);\n   const autocompleteRef = useRef(null);\n   const router = useRouter();\n \n-  // Carga de Google Maps SDK\n+  // Cargando Google Maps con tu clave de la imagen\n   const { isLoaded } = useJsApiLoader({\n-    googleMapsApiKey: \"AIzaSyD8KgUn-IqYYSgnllCyOgDcIPVDdEkel6I\", // REEMPLAZA ESTO\n+    googleMapsApiKey: \"AIzaSyD8KgUn-IqYYSgnllCyOgDcIPVDdEkel6I\",\n     libraries: libraries,\n   });\n \n-  // Manejo de autocompletado de dirección\n   const onPlaceChanged = () => {\n     if (autocompleteRef.current !== null) {\n       const place = autocompleteRef.current.getPlace();\n-\n+      \n       if (!place.geometry) {\n-        alert(\"Por favor, selecciona una dirección de la lista desplegable.\");\n+        alert(\"Por favor, selecciona una dirección sugerida en la lista.\");\n         return;\n       }\n \n+      // Extrae coordenadas y dirección formateada\n       const lat = place.geometry.location.lat();\n       const lng = place.geometry.location.lng();\n       const address = place.formatted_address || place.name;\n \n@@ -383,31 +372,20 @@\n \n   const handleSubmit = async (e) => {\n     e.preventDefault();\n     if (imagenes.length === 0 || !formData.lat) {\n-      return alert(\n-        \"Faltan fotos o la ubicación exacta (debes seleccionar una del buscador)\"\n-      );\n+      return alert(\"Debes seleccionar una dirección válida y subir al menos una foto.\");\n     }\n-\n+    \n     setLoading(true);\n     try {\n       const user = auth.currentUser;\n-      if (!user) throw new Error(\"No hay usuario autenticado\");\n-\n       const urls = [];\n       for (const file of imagenes) {\n-        const compressed = await Compressor(file, {\n-          quality: 0.6,\n-          maxWidth: 1024,\n-        });\n-        const sRef = ref(\n-          storage,\n-          `propiedades/${user.uid}/${Date.now()}_${file.name}`\n-        );\n+        const compressed = await Compressor(file, { quality: 0.6, maxWidth: 1024 });\n+        const sRef = ref(storage, `propiedades/${user.uid}/${Date.now()}_${file.name}`);\n         await uploadBytes(sRef, compressed);\n-        const url = await getDownloadURL(sRef);\n-        urls.push(url);\n+        urls.push(await getDownloadURL(sRef));\n       }\n \n       await addDoc(collection(db, \"propiedades\"), {\n         ...formData,\n@@ -421,217 +399,119 @@\n       });\n \n       router.push(\"/mapa\");\n     } catch (err) {\n-      console.error(err);\n       alert(\"Error al guardar la propiedad\");\n     } finally {\n       setLoading(false);\n     }\n   };\n \n   return (\n-    <div className=\"max-w-2xl mx-auto p-4\">\n-      <form\n-        onSubmit={handleSubmit}\n-        className=\"space-y-8 animate-in fade-in duration-500\"\n-      >\n-        {/* Sección 1: Detalles Básicos */}\n+    <div className=\"max-w-2xl mx-auto p-4 pb-20\">\n+      <form onSubmit={handleSubmit} className=\"space-y-8 animate-in fade-in duration-500\">\n+        \n+        {/* Información General */}\n         <section className=\"space-y-4\">\n-          <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400 mb-4\">\n-            Información General\n-          </h3>\n+          <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400\">Información General</h3>\n           <InputField\n-            label=\"Título del anuncio\"\n+            label=\"Título\"\n             name=\"titulo\"\n-            placeholder=\"Ej: Penthouse con vista al mar\"\n+            placeholder=\"Ej: Apartamento en Pocitos\"\n             value={formData.titulo}\n             onChange={handleChange}\n             required\n           />\n-\n           <div className=\"grid grid-cols-2 gap-4\">\n-            <InputField\n-              label=\"Precio (USD)\"\n-              name=\"precio\"\n-              type=\"number\"\n-              placeholder=\"0.00\"\n-              value={formData.precio}\n-              onChange={handleChange}\n-              required\n-            />\n-            <SelectField\n-              label=\"Dormitorios\"\n-              name=\"dormitorios\"\n-              value={formData.dormitorios}\n-              onChange={handleChange}\n-              options={[1, 2, 3, 4, 5]}\n-              required\n-            />\n+            <InputField label=\"Precio (USD)\" name=\"precio\" type=\"number\" value={formData.precio} onChange={handleChange} required />\n+            <SelectField label=\"Dorms\" name=\"dormitorios\" value={formData.dormitorios} onChange={handleChange} options={[1, 2, 3, 4, 5]} required />\n           </div>\n         </section>\n \n-        {/* Sección 2: Ubicación con Autocomplete */}\n+        {/* Ubicación con Autocomplete */}\n         <section className=\"space-y-4\">\n-          <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400 mb-4\">\n-            Ubicación\n-          </h3>\n+          <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400\">Ubicación</h3>\n           <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n-            <SelectField\n-              label=\"Barrio\"\n-              name=\"barrio\"\n-              value={formData.barrio}\n-              onChange={handleChange}\n-              options={barriosMontevideo}\n-              isString\n-              required\n-            />\n-\n-            <div className=\"flex flex-col gap-1 w-full\">\n-              <label className=\"text-xs font-bold text-gray-700 ml-1\">\n-                Dirección Exacta\n-              </label>\n+            <SelectField label=\"Barrio\" name=\"barrio\" value={formData.barrio} onChange={handleChange} options={barriosMontevideo} isString required />\n+            \n+            <div className=\"flex flex-col gap-1\">\n+              <label className=\"text-xs font-bold text-gray-700 ml-1\">Dirección Exacta</label>\n               {isLoaded ? (\n                 <Autocomplete\n-                  onLoad={(autocomplete) =>\n-                    (autocompleteRef.current = autocomplete)\n-                  }\n+                  onLoad={(ref) => (autocompleteRef.current = ref)}\n                   onPlaceChanged={onPlaceChanged}\n-                  options={{\n-                    componentRestrictions: { country: \"uy\" },\n-                    fields: [\"geometry\", \"formatted_address\", \"name\"],\n-                  }}\n+                  options={{ componentRestrictions: { country: \"uy\" } }}\n                 >\n                   <input\n                     type=\"text\"\n-                    name=\"direccion\"\n                     placeholder=\"Calle y número...\"\n-                    className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black transition-all\"\n+                    className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black\"\n                     value={formData.direccion}\n-                    onChange={(e) =>\n-                      setFormData({ ...formData, direccion: e.target.value })\n-                    }\n+                    onChange={(e) => setFormData({ ...formData, direccion: e.target.value })}\n                     required\n                   />\n                 </Autocomplete>\n               ) : (\n-                <div className=\"w-full h-12 bg-gray-100 animate-pulse rounded-lg\" />\n+                <div className=\"w-full h-11 bg-gray-100 animate-pulse rounded-lg\" />\n               )}\n             </div>\n           </div>\n-\n-          {/* Indicador visual de coordenadas obtenidas */}\n           {formData.lat && (\n-            <div className=\"flex items-center gap-2 text-green-600 text-xs font-medium bg-green-50 p-2 rounded-lg\">\n-              <svg\n-                width=\"16\"\n-                height=\"16\"\n-                fill=\"currentColor\"\n-                viewBox=\"0 0 20 20\"\n-              >\n-                <path\n-                  fillRule=\"evenodd\"\n-                  d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\"\n-                  clipRule=\"evenodd\"\n-                />\n-              </svg>\n-              Ubicación georeferenciada correctamente\n+            <div className=\"text-[11px] text-green-600 font-bold bg-green-50 p-2 rounded-lg flex items-center gap-2\">\n+              ✓ Ubicación georeferenciada (Lat: {parseFloat(formData.lat).toFixed(4)})\n             </div>\n           )}\n         </section>\n \n-        {/* Sección 3: Multimedia */}\n+        {/* Multimedia */}\n         <section className=\"space-y-4\">\n-          <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400 mb-4\">\n-            Fotos de la propiedad (Máx 5)\n-          </h3>\n+          <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400\">Fotos (Máx 5)</h3>\n           <div className=\"grid grid-cols-3 sm:grid-cols-5 gap-3\">\n             {previewUrls.map((url, i) => (\n-              <div key={i} className=\"relative aspect-square group\">\n-                <img\n-                  src={url}\n-                  className=\"h-full w-full object-cover rounded-xl border border-gray-100\"\n-                  alt=\"Vista previa\"\n-                />\n-                <button\n-                  type=\"button\"\n-                  onClick={() => removeImage(i)}\n-                  className=\"absolute -top-2 -right-2 bg-black text-white rounded-full w-6 h-6 flex items-center justify-center shadow-xl opacity-0 group-hover:opacity-100 transition-opacity\"\n-                >\n-                  ×\n-                </button>\n+              <div key={i} className=\"relative aspect-square\">\n+                <img src={url} className=\"h-full w-full object-cover rounded-xl border\" />\n+                <button type=\"button\" onClick={() => removeImage(i)} className=\"absolute -top-1 -right-1 bg-black text-white rounded-full w-5 h-5 text-xs\">×</button>\n               </div>\n             ))}\n             {imagenes.length < 5 && (\n-              <button\n-                type=\"button\"\n-                onClick={() => fileInputRef.current?.click()}\n-                className=\"aspect-square flex flex-col items-center justify-center border-2 border-dashed border-gray-200 rounded-xl hover:border-black hover:bg-gray-50 transition-all text-gray-400 hover:text-black\"\n-              >\n-                <span className=\"text-2xl\">+</span>\n-                <span className=\"text-[10px] font-medium uppercase\">Subir</span>\n+              <button type=\"button\" onClick={() => fileInputRef.current?.click()} className=\"aspect-square flex flex-col items-center justify-center border-2 border-dashed border-gray-200 rounded-xl hover:bg-gray-50 text-gray-400\">\n+                <span className=\"text-xl\">+</span>\n               </button>\n             )}\n           </div>\n-          <input\n-            type=\"file\"\n-            ref={fileInputRef}\n-            onChange={handleImageChange}\n-            accept=\"image/*\"\n-            multiple\n-            className=\"hidden\"\n-          />\n+          <input type=\"file\" ref={fileInputRef} onChange={handleImageChange} accept=\"image/*\" multiple className=\"hidden\" />\n         </section>\n \n-        {/* Botón Final */}\n-        <div className=\"pt-6\">\n-          <button\n-            type=\"submit\"\n-            disabled={loading}\n-            className=\"w-full bg-black py-4 text-white font-medium text-lg rounded-xl hover:bg-gray-800 transition-all disabled:bg-gray-200 flex items-center justify-center gap-3\"\n-          >\n-            {loading ? (\n-              <>\n-                <div className=\"h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n-                Publicando...\n-              </>\n-            ) : (\n-              \"Confirmar y Publicar\"\n-            )}\n-          </button>\n-        </div>\n+        <button\n+          type=\"submit\"\n+          disabled={loading}\n+          className=\"w-full bg-black py-4 text-white font-bold rounded-xl hover:bg-zinc-800 disabled:bg-gray-300 transition-colors\"\n+        >\n+          {loading ? \"Publicando...\" : \"Confirmar y Publicar\"}\n+        </button>\n       </form>\n     </div>\n   );\n }\n \n-// Helpers de Estilo\n function InputField({ label, ...props }) {\n   return (\n     <div className=\"flex flex-col gap-1 w-full\">\n       <label className=\"text-xs font-bold text-gray-700 ml-1\">{label}</label>\n-      <input\n-        {...props}\n-        className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black transition-all placeholder:text-gray-400\"\n-      />\n+      <input {...props} className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black outline-none\" />\n     </div>\n   );\n }\n \n function SelectField({ label, options, isString, ...props }) {\n   return (\n     <div className=\"flex flex-col gap-1 w-full\">\n       <label className=\"text-xs font-bold text-gray-700 ml-1\">{label}</label>\n-      <select\n-        {...props}\n-        className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black transition-all appearance-none\"\n-      >\n+      <select {...props} className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black outline-none appearance-none\">\n         <option value=\"\">Seleccionar</option>\n         {options.map((o) => (\n-          <option key={o} value={o}>\n-            {isString ? o : `${o} dorms`}\n-          </option>\n+          <option key={o} value={o}>{isString ? o : `${o} dorms`}</option>\n         ))}\n       </select>\n     </div>\n   );\n-}\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1765953664527,
            "name": "Commit-0",
            "content": "// \"use client\";\n\n// import { addDoc, collection, serverTimestamp } from \"firebase/firestore\";\n// import { ref, uploadBytes, getDownloadURL } from \"firebase/storage\";\n// import { auth, db, storage } from \"@/services/firebase\";\n// import { useRouter } from \"next/navigation\";\n// import { useState, useRef } from \"react\";\n// import Compressor from \"browser-image-compression\";\n\n// const barriosMontevideo = [\n//   \"Pocitos\",\n//   \"Carrasco\",\n//   \"Centro\",\n//   \"Ciudad Vieja\",\n//   \"Buceo\",\n//   \"Malvín\",\n//   \"Punta Carretas\",\n//   \"Prado\",\n//   \"Parque Rodó\",\n//   \"Cordón\",\n//   \"La Blanqueada\",\n//   \"Tres Cruces\",\n//   \"Parque Batlle\",\n// ];\n\n// export default function PropertyForm() {\n//   const [formData, setFormData] = useState({\n//     titulo: \"\",\n//     precio: \"\",\n//     dormitorios: \"\",\n//     barrio: \"\",\n//     direccion: \"\",\n//     lat: \"\",\n//     lng: \"\",\n//   });\n//   const [imagenes, setImagenes] = useState([]);\n//   const [previewUrls, setPreviewUrls] = useState([]);\n//   const [loading, setLoading] = useState(false);\n//   const fileInputRef = useRef(null);\n//   const router = useRouter();\n\n//   const handleGeolocate = () => {\n//     if (!navigator.geolocation) return alert(\"Geolocalización no soportada\");\n//     navigator.geolocation.getCurrentPosition(\n//       (pos) =>\n//         setFormData((prev) => ({\n//           ...prev,\n//           lat: pos.coords.latitude.toString(),\n//           lng: pos.coords.longitude.toString(),\n//         })),\n//       () => alert(\"No se pudo obtener tu ubicación\")\n//     );\n//   };\n\n//   const handleImageChange = (e) => {\n//     const files = Array.from(e.target.files);\n//     if (files.length + imagenes.length > 5) return alert(\"Máximo 5 fotos\");\n//     setImagenes((prev) => [...prev, ...files]);\n//     setPreviewUrls((prev) => [\n//       ...prev,\n//       ...files.map((file) => URL.createObjectURL(file)),\n//     ]);\n//   };\n\n//   const removeImage = (index) => {\n//     setImagenes((prev) => prev.filter((_, i) => i !== index));\n//     setPreviewUrls((prev) => prev.filter((_, i) => i !== index));\n//   };\n\n//   const handleChange = (e) =>\n//     setFormData({ ...formData, [e.target.name]: e.target.value });\n\n//   const handleSubmit = async (e) => {\n//     e.preventDefault();\n//     if (imagenes.length === 0 || !formData.lat)\n//       return alert(\"Faltan fotos o ubicación\");\n//     setLoading(true);\n//     try {\n//       const user = auth.currentUser;\n//       const urls = [];\n//       for (const file of imagenes) {\n//         const compressed = await Compressor(file, {\n//           quality: 0.6,\n//           maxWidth: 1024,\n//         });\n//         const sRef = ref(\n//           storage,\n//           `propiedades/${user.uid}/${Date.now()}_${file.name}`\n//         );\n//         await uploadBytes(sRef, compressed);\n//         urls.push(await getDownloadURL(sRef));\n//       }\n//       await addDoc(collection(db, \"propiedades\"), {\n//         ...formData,\n//         precio: Number(formData.precio),\n//         lat: parseFloat(formData.lat),\n//         lng: parseFloat(formData.lng),\n//         fotos: urls,\n//         agenteId: user.uid,\n//         createdAt: serverTimestamp(),\n//         activa: true,\n//       });\n//       router.push(\"/mapa\");\n//     } catch (err) {\n//       alert(\"Error al guardar\");\n//     } finally {\n//       setLoading(false);\n//     }\n//   };\n\n//   return (\n//     <form\n//       onSubmit={handleSubmit}\n//       className=\"space-y-8 animate-in fade-in duration-500\"\n//     >\n//       {/* Sección 1: Detalles Básicos */}\n//       <section className=\"space-y-4\">\n//         <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400 mb-4\">\n//           Información General\n//         </h3>\n//         <InputField\n//           label=\"Título del anuncio\"\n//           name=\"titulo\"\n//           placeholder=\"Ej: Penthouse con vista al mar\"\n//           value={formData.titulo}\n//           onChange={handleChange}\n//         />\n\n//         <div className=\"grid grid-cols-2 gap-4\">\n//           <InputField\n//             label=\"Precio (USD)\"\n//             name=\"precio\"\n//             type=\"number\"\n//             placeholder=\"0.00\"\n//             value={formData.precio}\n//             onChange={handleChange}\n//           />\n//           <SelectField\n//             label=\"Dormitorios\"\n//             name=\"dormitorios\"\n//             value={formData.dormitorios}\n//             onChange={handleChange}\n//             options={[1, 2, 3, 4, 5]}\n//           />\n//         </div>\n//       </section>\n\n//       {/* Sección 2: Ubicación */}\n//       <section className=\"space-y-4\">\n//         <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400 mb-4\">\n//           Ubicación\n//         </h3>\n//         <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n//           <SelectField\n//             label=\"Barrio\"\n//             name=\"barrio\"\n//             value={formData.barrio}\n//             onChange={handleChange}\n//             options={barriosMontevideo}\n//             isString\n//           />\n//           <InputField\n//             label=\"Dirección\"\n//             name=\"direccion\"\n//             placeholder=\"Calle y número\"\n//             value={formData.direccion}\n//             onChange={handleChange}\n//           />\n//         </div>\n\n//         <button\n//           type=\"button\"\n//           onClick={handleGeolocate}\n//           className={`w-full flex items-center justify-center gap-2 py-3 rounded-lg border-2 transition-all ${\n//             formData.lat\n//               ? \"border-green-500 bg-green-50 text-green-700\"\n//               : \"border-black bg-white text-black hover:bg-gray-50\"\n//           }`}\n//         >\n//           <svg\n//             width=\"20\"\n//             height=\"20\"\n//             fill=\"none\"\n//             stroke=\"currentColor\"\n//             strokeWidth=\"2\"\n//             viewBox=\"0 0 24 24\"\n//           >\n//             <path d=\"M12 21s-8-4.5-8-11.8A8 8 0 0112 2a8 8 0 018 7.2c0 7.3-8 11.8-8 11.8z\" />\n//             <circle cx=\"12\" cy=\"9\" r=\"3\" />\n//           </svg>\n//           {formData.lat ? \"Ubicación establecida\" : \"Marcar ubicación actual\"}\n//         </button>\n//       </section>\n\n//       {/* Sección 3: Multimedia */}\n//       <section className=\"space-y-4\">\n//         <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400 mb-4\">\n//           Fotos de la propiedad\n//         </h3>\n//         <div className=\"grid grid-cols-3 sm:grid-cols-5 gap-3\">\n//           {previewUrls.map((url, i) => (\n//             <div key={i} className=\"relative aspect-square group\">\n//               <img\n//                 src={url}\n//                 className=\"h-full w-full object-cover rounded-xl border border-gray-100\"\n//               />\n//               <button\n//                 type=\"button\"\n//                 onClick={() => removeImage(i)}\n//                 className=\"absolute -top-2 -right-2 bg-black text-white rounded-full w-6 h-6 flex items-center justify-center shadow-xl opacity-0 group-hover:opacity-100 transition-opacity\"\n//               >\n//                 ×\n//               </button>\n//             </div>\n//           ))}\n//           {imagenes.length < 5 && (\n//             <button\n//               type=\"button\"\n//               onClick={() => fileInputRef.current?.click()}\n//               className=\"aspect-square flex flex-col items-center justify-center border-2 border-dashed border-gray-200 rounded-xl hover:border-black hover:bg-gray-50 transition-all text-gray-400 hover:text-black\"\n//             >\n//               <span className=\"text-2xl\">+</span>\n//               <span className=\"text-[10px] font-medium uppercase\">Subir</span>\n//             </button>\n//           )}\n//         </div>\n//         <input\n//           type=\"file\"\n//           ref={fileInputRef}\n//           onChange={handleImageChange}\n//           accept=\"image/*\"\n//           multiple\n//           className=\"hidden\"\n//         />\n//       </section>\n\n//       {/* Botón Final */}\n//       <div className=\"pt-6\">\n//         <button\n//           type=\"submit\"\n//           disabled={loading}\n//           className=\"w-full bg-black py-4 text-white font-medium text-lg rounded-xl hover:bg-gray-800 transition-all disabled:bg-gray-200 flex items-center justify-center gap-3\"\n//         >\n//           {loading ? (\n//             <>\n//               <div className=\"h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n//               Publicando...\n//             </>\n//           ) : (\n//             \"Confirmar y Publicar\"\n//           )}\n//         </button>\n//       </div>\n//     </form>\n//   );\n// }\n\n// // Helpers para mantener el estilo Uber\n// function InputField({ label, ...props }) {\n//   return (\n//     <div className=\"flex flex-col gap-1 w-full\">\n//       <label className=\"text-xs font-bold text-gray-700 ml-1\">{label}</label>\n//       <input\n//         {...props}\n//         className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black transition-all\"\n//       />\n//     </div>\n//   );\n// }\n\n// function SelectField({ label, options, isString, ...props }) {\n//   return (\n//     <div className=\"flex flex-col gap-1 w-full\">\n//       <label className=\"text-xs font-bold text-gray-700 ml-1\">{label}</label>\n//       <select\n//         {...props}\n//         className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black transition-all appearance-none\"\n//       >\n//         <option value=\"\">Seleccionar</option>\n//         {options.map((o) => (\n//           <option key={o} value={o}>\n//             {isString ? o : `${o} dorms`}\n//           </option>\n//         ))}\n//       </select>\n//     </div>\n//   );\n// }\n\"use client\";\n\nimport { addDoc, collection, serverTimestamp } from \"firebase/firestore\";\nimport { ref, uploadBytes, getDownloadURL } from \"firebase/storage\";\nimport { auth, db, storage } from \"@/services/firebase\";\nimport { useRouter } from \"next/navigation\";\nimport { useState, useRef, useMemo } from \"react\";\nimport Compressor from \"browser-image-compression\";\nimport { useJsApiLoader, Autocomplete } from \"@react-google-maps/api\";\n\nconst barriosMontevideo = [\n  \"Pocitos\", \"Carrasco\", \"Centro\", \"Ciudad Vieja\", \"Buceo\", \n  \"Malvín\", \"Punta Carretas\", \"Prado\", \"Parque Rodó\", \n  \"Cordón\", \"La Blanqueada\", \"Tres Cruces\", \"Parque Batlle\",\n];\n\n// Definimos las librerías fuera del componente para evitar re-renders innecesarios\nconst libraries = [\"places\"];\n\nexport default function PropertyForm() {\n  const [formData, setFormData] = useState({\n    titulo: \"\",\n    precio: \"\",\n    dormitorios: \"\",\n    barrio: \"\",\n    direccion: \"\",\n    lat: \"\",\n    lng: \"\",\n  });\n\n  const [imagenes, setImagenes] = useState([]);\n  const [previewUrls, setPreviewUrls] = useState([]);\n  const [loading, setLoading] = useState(false);\n  \n  const fileInputRef = useRef(null);\n  const autocompleteRef = useRef(null);\n  const router = useRouter();\n\n  // Carga de Google Maps SDK\n  const { isLoaded } = useJsApiLoader({\n    googleMapsApiKey: \"TU_API_KEY_AQUI\", // REEMPLAZA ESTO\n    libraries: libraries,\n  });\n\n  // Manejo de autocompletado de dirección\n  const onPlaceChanged = () => {\n    if (autocompleteRef.current !== null) {\n      const place = autocompleteRef.current.getPlace();\n      \n      if (!place.geometry) {\n        alert(\"Por favor, selecciona una dirección de la lista desplegable.\");\n        return;\n      }\n\n      const lat = place.geometry.location.lat();\n      const lng = place.geometry.location.lng();\n      const address = place.formatted_address || place.name;\n\n      setFormData((prev) => ({\n        ...prev,\n        direccion: address,\n        lat: lat.toString(),\n        lng: lng.toString(),\n      }));\n    }\n  };\n\n  const handleImageChange = (e) => {\n    const files = Array.from(e.target.files);\n    if (files.length + imagenes.length > 5) return alert(\"Máximo 5 fotos\");\n    setImagenes((prev) => [...prev, ...files]);\n    setPreviewUrls((prev) => [\n      ...prev,\n      ...files.map((file) => URL.createObjectURL(file)),\n    ]);\n  };\n\n  const removeImage = (index) => {\n    setImagenes((prev) => prev.filter((_, i) => i !== index));\n    setPreviewUrls((prev) => prev.filter((_, i) => i !== index));\n  };\n\n  const handleChange = (e) =>\n    setFormData({ ...formData, [e.target.name]: e.target.value });\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (imagenes.length === 0 || !formData.lat) {\n      return alert(\"Faltan fotos o la ubicación exacta (debes seleccionar una del buscador)\");\n    }\n    \n    setLoading(true);\n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error(\"No hay usuario autenticado\");\n\n      const urls = [];\n      for (const file of imagenes) {\n        const compressed = await Compressor(file, {\n          quality: 0.6,\n          maxWidth: 1024,\n        });\n        const sRef = ref(\n          storage,\n          `propiedades/${user.uid}/${Date.now()}_${file.name}`\n        );\n        await uploadBytes(sRef, compressed);\n        const url = await getDownloadURL(sRef);\n        urls.push(url);\n      }\n\n      await addDoc(collection(db, \"propiedades\"), {\n        ...formData,\n        precio: Number(formData.precio),\n        lat: parseFloat(formData.lat),\n        lng: parseFloat(formData.lng),\n        fotos: urls,\n        agenteId: user.uid,\n        createdAt: serverTimestamp(),\n        activa: true,\n      });\n\n      router.push(\"/mapa\");\n    } catch (err) {\n      console.error(err);\n      alert(\"Error al guardar la propiedad\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto p-4\">\n      <form\n        onSubmit={handleSubmit}\n        className=\"space-y-8 animate-in fade-in duration-500\"\n      >\n        {/* Sección 1: Detalles Básicos */}\n        <section className=\"space-y-4\">\n          <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400 mb-4\">\n            Información General\n          </h3>\n          <InputField\n            label=\"Título del anuncio\"\n            name=\"titulo\"\n            placeholder=\"Ej: Penthouse con vista al mar\"\n            value={formData.titulo}\n            onChange={handleChange}\n            required\n          />\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <InputField\n              label=\"Precio (USD)\"\n              name=\"precio\"\n              type=\"number\"\n              placeholder=\"0.00\"\n              value={formData.precio}\n              onChange={handleChange}\n              required\n            />\n            <SelectField\n              label=\"Dormitorios\"\n              name=\"dormitorios\"\n              value={formData.dormitorios}\n              onChange={handleChange}\n              options={[1, 2, 3, 4, 5]}\n              required\n            />\n          </div>\n        </section>\n\n        {/* Sección 2: Ubicación con Autocomplete */}\n        <section className=\"space-y-4\">\n          <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400 mb-4\">\n            Ubicación\n          </h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <SelectField\n              label=\"Barrio\"\n              name=\"barrio\"\n              value={formData.barrio}\n              onChange={handleChange}\n              options={barriosMontevideo}\n              isString\n              required\n            />\n            \n            <div className=\"flex flex-col gap-1 w-full\">\n              <label className=\"text-xs font-bold text-gray-700 ml-1\">Dirección Exacta</label>\n              {isLoaded ? (\n                <Autocomplete\n                  onLoad={(autocomplete) => (autocompleteRef.current = autocomplete)}\n                  onPlaceChanged={onPlaceChanged}\n                  options={{\n                    componentRestrictions: { country: \"uy\" },\n                    fields: [\"geometry\", \"formatted_address\", \"name\"],\n                  }}\n                >\n                  <input\n                    type=\"text\"\n                    name=\"direccion\"\n                    placeholder=\"Calle y número...\"\n                    className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black transition-all\"\n                    value={formData.direccion}\n                    onChange={(e) => setFormData({ ...formData, direccion: e.target.value })}\n                    required\n                  />\n                </Autocomplete>\n              ) : (\n                <div className=\"w-full h-12 bg-gray-100 animate-pulse rounded-lg\" />\n              )}\n            </div>\n          </div>\n\n          {/* Indicador visual de coordenadas obtenidas */}\n          {formData.lat && (\n            <div className=\"flex items-center gap-2 text-green-600 text-xs font-medium bg-green-50 p-2 rounded-lg\">\n              <svg width=\"16\" height=\"16\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n              </svg>\n              Ubicación georeferenciada correctamente\n            </div>\n          )}\n        </section>\n\n        {/* Sección 3: Multimedia */}\n        <section className=\"space-y-4\">\n          <h3 className=\"text-sm font-bold uppercase tracking-widest text-gray-400 mb-4\">\n            Fotos de la propiedad (Máx 5)\n          </h3>\n          <div className=\"grid grid-cols-3 sm:grid-cols-5 gap-3\">\n            {previewUrls.map((url, i) => (\n              <div key={i} className=\"relative aspect-square group\">\n                <img\n                  src={url}\n                  className=\"h-full w-full object-cover rounded-xl border border-gray-100\"\n                  alt=\"Vista previa\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => removeImage(i)}\n                  className=\"absolute -top-2 -right-2 bg-black text-white rounded-full w-6 h-6 flex items-center justify-center shadow-xl opacity-0 group-hover:opacity-100 transition-opacity\"\n                >\n                  ×\n                </button>\n              </div>\n            ))}\n            {imagenes.length < 5 && (\n              <button\n                type=\"button\"\n                onClick={() => fileInputRef.current?.click()}\n                className=\"aspect-square flex flex-col items-center justify-center border-2 border-dashed border-gray-200 rounded-xl hover:border-black hover:bg-gray-50 transition-all text-gray-400 hover:text-black\"\n              >\n                <span className=\"text-2xl\">+</span>\n                <span className=\"text-[10px] font-medium uppercase\">Subir</span>\n              </button>\n            )}\n          </div>\n          <input\n            type=\"file\"\n            ref={fileInputRef}\n            onChange={handleImageChange}\n            accept=\"image/*\"\n            multiple\n            className=\"hidden\"\n          />\n        </section>\n\n        {/* Botón Final */}\n        <div className=\"pt-6\">\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full bg-black py-4 text-white font-medium text-lg rounded-xl hover:bg-gray-800 transition-all disabled:bg-gray-200 flex items-center justify-center gap-3\"\n          >\n            {loading ? (\n              <>\n                <div className=\"h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                Publicando...\n              </>\n            ) : (\n              \"Confirmar y Publicar\"\n            )}\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n\n// Helpers de Estilo\nfunction InputField({ label, ...props }) {\n  return (\n    <div className=\"flex flex-col gap-1 w-full\">\n      <label className=\"text-xs font-bold text-gray-700 ml-1\">{label}</label>\n      <input\n        {...props}\n        className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black transition-all placeholder:text-gray-400\"\n      />\n    </div>\n  );\n}\n\nfunction SelectField({ label, options, isString, ...props }) {\n  return (\n    <div className=\"flex flex-col gap-1 w-full\">\n      <label className=\"text-xs font-bold text-gray-700 ml-1\">{label}</label>\n      <select\n        {...props}\n        className=\"w-full bg-[#f6f6f6] border-none px-4 py-3 rounded-lg text-black focus:ring-2 focus:ring-black transition-all appearance-none\"\n      >\n        <option value=\"\">Seleccionar</option>\n        {options.map((o) => (\n          <option key={o} value={o}>\n            {isString ? o : `${o} dorms`}\n          </option>\n        ))}\n      </select>\n    </div>\n  );\n}"
        }
    ]
}